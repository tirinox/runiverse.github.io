(function(){"use strict";var t={7513:function(t,e,s){var o=s(9242),i=s(3396);function n(t,e,s,o,n,r){const a=(0,i.up)("MainScreen");return(0,i.wg)(),(0,i.j4)(a)}var r=s(7139);const a={class:"canvas-holder"},c={class:"control-panel"};function h(t,e,s,n,h,d){const l=(0,i.up)("FPSCounter");return(0,i.wg)(),(0,i.iD)("div",a,[(0,i._)("canvas",{class:"canvas-full",ref:"canvas",tabindex:"1",onKeydown:e[0]||(e[0]=(...t)=>d.onKeyDown&&d.onKeyDown(...t)),onMousemove:e[1]||(e[1]=(...t)=>d.onMouseMove&&d.onMouseMove(...t)),onMouseenter:e[2]||(e[2]=(...t)=>d.onMouseEnter&&d.onMouseEnter(...t)),onMouseleave:e[3]||(e[3]=(...t)=>d.onMouseLeave&&d.onMouseLeave(...t))},null,544),(0,i.wy)((0,i.Wm)(l,{ref:"fps"},null,512),[[o.F8,h.showFps]]),(0,i._)("div",c,[(0,i._)("button",{onClick:e[4]||(e[4]=t=>d.setSceneMode("normal")),class:(0,r.C_)(d.isButtonSelectedClass("normal"))},"NORMAL",2),(0,i._)("button",{onClick:e[5]||(e[5]=t=>d.setSceneMode("status")),class:(0,r.C_)(d.isButtonSelectedClass("status"))},"STATUS",2),(0,i._)("button",{onClick:e[6]||(e[6]=t=>d.setSceneMode("provider")),class:(0,r.C_)(d.isButtonSelectedClass("provider"))},"PROVIDER",2)])])}var d=s(1114);const l={DataSource:{NodesURL:"https://thornode.ninerealms.com/thorchain/nodes",PollPeriod:3,ReactRandomDelay:2.5},Font:{Main:"fonts/Exo2-VariableFont_wght.ttf"},Effects:{Bloom:{Enabled:!0,Strength:.5,Threshold:.5,Radius:.5}},Controls:{Camera:{Distance:{Min:800,Max:2500,Start:1800},AzimuthAngleLimit:30,PolarAngleLimit:35}},Scene:{Sky:{SkyBox:"/texture/skybox/nebula1",SkyBoxExt:"jpg"}},Physics:{BaseForce:1500}},u={LightningBlue:52479,YggdrasilGreen:3407769,MidgardTurqoise:2350280,NightBlack:1055009};var p=s(8657),m=s(2071),f=s(2338),g=s(9868);const y={class:"fps-counter"},_={class:"activity"};function v(t,e,s,n,a,c){return(0,i.wg)(),(0,i.iD)("div",y,[(0,i._)("span",null,[(0,i._)("strong",null,(0,r.zw)(Number(a.fps).toFixed(2)),1),(0,i.Uk)(" FPS, "+(0,r.zw)(a.objCount)+" objects",1)]),(0,i.wy)((0,i._)("span",_,"â€¢",512),[[o.F8,a.activityIndicator]])])}function b(t){let e=0;return t.traverse((function(){e++})),e}function S(t){t&&t.remove.apply(t,t.children)}var w={name:"FPSCounter",props:{updatePeriod:{type:Number,default:1}},data(){return{fps:0,objCount:0,activityIndicator:!1,lastUpdateTime:0}},methods:{pokeActivity(){this.activityIndicator=!0,setTimeout((()=>{this.activityIndicator=!1}),100)},update(t,e){t>0&&+Date.now()-1e3*this.updatePeriod>this.lastUpdateTime&&(this.fps=1/t,this.objCount=b(e),this.lastUpdateTime=+Date.now())}}},x=s(89);const E=(0,x.Z)(w,[["render",v],["__scopeId","data-v-590dbc21"]]);var M=E,C=s(4806),R=s.n(C);function T(t,e){return void 0===t?e:t}class O{static getRandomInt(t){return Math.floor(Math.random()*t)}static getRandomFloat(t,e){return Math.random()*(e-t)+t}static getRandomSample(t){if(!t)return null;const e=O.getRandomInt(t.length);return t[e]}static removeRandomItem(t){if(Math.random()>.5){const e=O.getRandomInt(t.length);t.splice(e,1)}return t}static randomVector({xMin:t,xMax:e,yMin:s,yMax:o,zMin:i,zMax:n}){return t=T(t,-10),e=T(e,10),s=T(s,-10),o=T(o,10),i=T(i,-10),n=T(n,10),new d.Vector3(O.getRandomFloat(t,e),O.getRandomFloat(s,o),O.getRandomFloat(i,n))}static randomOnCircle(t=100,e=0,s=0){const o=O.getRandomFloat(0,2*Math.PI);return new d.Vector3(e+t*Math.cos(o),s+t*Math.sin(o))}}class k{constructor(t,e){this.p1=t,this.p2=e}get dx(){return this.p2.x-this.p1.x}get dy(){return this.p2.y-this.p1.y}whichSide(t,e){const s=t-this.p1.x,o=e-this.p1.y,i=this.dx,n=this.dy;return Math.sign(s*i-o*n)}get center(){return{x:.5*(this.p1.x+this.p2.x),y:.5*(this.p1.y+this.p2.y)}}nearestPoint(t,e){const s=t-this.p1.x,o=e-this.p1.y,i=this.dx,n=this.dy,r=s*i+o*n,a=i*i+n*n;let c=-1;return 0!==a&&(c=r/a),c<0?(t=this.p1.x,e=this.p1.y):c>1?(t=this.p2.x,e=this.p2.y):(t=this.p1.x+c*i,e=this.p1.y+c*n),{x:t,y:e}}pDistance(t,e){const s=this.nearestPoint(t,e);return new k(s,{x:t,y:e}).length}get length(){const t=this.dx,e=this.dy;return Math.sqrt(t*t+e*e)}}class P{static clamp(t,e,s){return Math.min(+s,Math.max(+e,+t))}static centerOf(t){if(!t||!t.length)return;let e=R().sumBy(t,(t=>t.x)),s=R().sumBy(t,(t=>t.y));return{x:e/t.length,y:s/t.length}}static _signHelper(t,e,s){return(t.x-s.x)*(e.y-s.y)-(e.x-s.x)*(t.y-s.y)}static pointInTriangle(t,e){const[s,o,i]=e,n=P._signHelper(t,s,o),r=P._signHelper(t,o,i),a=P._signHelper(t,i,s),c=n<0||r<0||a<0,h=n>0||r>0||a>0;return!(c&&h)}}const A=Object.freeze({CREATE:"create",DESTROY:"destroy",SLASH:"slash",IP_ADDRESS:"ip_address",STATUS:"status",VERSION:"version",FORCED_LEAVE:"forced_to_leave",REQUESTED_LEAVE:"requested_to_leave",AWARD:"current_award",BOND_CHANGE:"bond",OBSERVE_CHAIN:"observe_chains",ACTIVE_BLOCK_HEIGHT:"active_block_height"});class D{constructor(t,e,s,o,i){this.type=t,this.node=e,this.prevNode=s,this.currValue=o,this.prevValue=i,this.isTramp=!!e&&""===e.node_address}toString(){const t=this.node?this.node.node_address:"?";return`NodeEvent(${this.type}, ${t}, ${this.currValue} => ${this.prevValue})`}}D.EVENT_TYPE=A;const j={Standby:"Standby",Whitelisted:"Whitelisted",Disabled:"Disabled",Active:"Active",Unknown:"Unknown"};class N{constructor(t,e){this.prev=N.prepareNodeList(t),this.curr=N.prepareNodeList(e)}static convertNode(t){return{node_address:t.node_address,status:t.status,active_block_height:BigInt(t.active_block_height),bond:BigInt(t.bond),ip_address:t.ip_address,current_award:BigInt(t.current_award),slash_points:t.slash_points,observe_chains:R().sortBy(t.observe_chains,["chain"]),requested_to_leave:Boolean(t.requested_to_leave),forced_to_leave:Boolean(t.forced_to_leave),version:t.version,bond_providers:{node_address:t.bond_providers.node_address,node_operator_fee:BigInt(t.bond_providers.node_operator_fee),providers:R().sortBy(t.bond_providers.providers||[],["bond","bond_address"])},jail:{node_address:t.jail.node_address,release_height:t.jail.release_height,reason:t.jail.reason||""}}}static prepareNodeList(t){t=R().map(t,N.convertNode);const e=R().filter(t,(t=>t.node_address)),s=t.length-e.length,o=R().keyBy(e,"node_address"),i=R().keys(o);return{trampCount:s,nodeMap:o,nameSet:i}}extractEvents(){const t=[],e=(e,s,o,i)=>{i=i||"node_address",t.push(new D(e,s,o,s?s[i]:"",o?o[i]:""))},s=R().difference(this.curr.nameSet,this.prev.nameSet);for(const a of s){const t=this.curr.nodeMap[a];e(D.EVENT_TYPE.CREATE,t,t)}const o=R().difference(this.prev.nameSet,this.curr.nameSet);for(const a of o){const t=this.prev.nodeMap[a];e(D.EVENT_TYPE.DESTROY,t,t)}const i=D.EVENT_TYPE,n={slash_points:i.SLASH,bond:i.BOND_CHANGE,ip_address:i.IP_ADDRESS,status:i.STATUS,active_block_height:i.ACTIVE_BLOCK_HEIGHT,current_award:i.AWARD,observe_chains:i.OBSERVE_CHAIN},r=R().intersection(this.curr.nameSet,this.prev.nameSet);for(const a of r){const t=this.prev.nodeMap[a],s=this.curr.nodeMap[a],o=R().union(R().keys(t),R().keys(s)),i=R().filter(o,(e=>!R().isEqual(t[e],s[e])));for(const r of i){const o=n[r];o&&e(o,s,t,r)}}return t}}var F=s(9870);class L{constructor(){this.mass=1,this.force=new d.Vector3,this.velocity=new d.Vector3,this.friction=0,this.attractors=[]}update(t){this.attractors.forEach&&this.attractors.forEach((t=>t.applyForce(this)));const e=this.force.multiplyScalar(this.mass);this.velocity.copy(this.velocity.clone().add(e.multiplyScalar(t))),this.velocity.multiplyScalar(P.clamp(1-this.friction,0,1)),this.realObject.position.add(this.velocity.clone().multiplyScalar(t))}nullifyForce(){this.force.set(0,0,0)}get radius(){return 1}applyForceTo(t,e){this.force.add(t.copy().multiplyScalar(e))}get realObject(){return this}repel(t,e=100){if(t===this)return;const s=this.realObject.position,o=t.realObject.position,i=s.distanceTo(o),n=this.radius+t.radius;if(i<n){const i=s.clone().sub(o).normalize().multiplyScalar(e);this.force.add(i),t.force.add(i.negate())}}}const B=new d.IcosahedronGeometry(1,1),I=8,V=52;class z extends L{constructor(t){super(),this.node=t,this.normalizedBond=1e-7*Number(this.node.bond/10000000n),this.o=new d.Group,this.attractors=[],this.friction=.02,this._makeSphere(),this._makeLabel()}_makeSphere(){let t=1118481;const e=this.node.status;e===j.Standby?t=1473110:e===j.Active?t=O.getRandomSample([u.LightningBlue,u.YggdrasilGreen]):e===j.Disabled?t=15597568:e===j.Whitelisted?t=4473924:e===j.Unknown&&(t=1118532);const s=P.clamp(this.normalizedBond*V*.8,I,V);this.material=new d.MeshStandardMaterial({color:t,flatShading:!0}),this.mesh=new d.Mesh(B,this.material),this.mesh.scale.setScalar(s),this.o.add(this.mesh)}get realObject(){return this.o}_makeLabel(){const t=this.node.node_address;if(t&&t.length>=4){const e=this.nameTextObj=new F.xv;e.text=t.slice(-4),e.font=l.Font.Main,e.fontWeight=900,e.fontSize=15,e.position.z=42,e.color=16777215,e.anchorX="center",e.anchorY="middle",e.outlineWidth=2,e.sync(),this.o.add(e)}}dispose(){this.nameTextObj&&this.nameTextObj.dispose()}get radius(){return Math.max(this.mesh.scale.x,15)}reactChain(){this.mesh.rotateX(1);const t=this.o.position.clone().normalize(),e=t.cross(new d.Vector3(0,0,1)).multiplyScalar(100);this.velocity.add(e)}reactSlash(){const t=this.material.color.clone();this.velocity.set(O.getRandomFloat(-100,100),O.getRandomFloat(-100,100),0),this.material.color.set(16711680),setTimeout((()=>{this.material.color.set(t)}),100)}}class H{constructor(){this.objects={},this.repelForce=101}getByName(t){return this.objects[t]}addObject(t,e){const s=this.getByName(t);if(s)return console.warn("PhysObj already exists. No nothing"),s;this.objects[t]=e}removeObject(t){const e=this.getByName(t);e?(e.dispose(),delete this.objects[t]):console.error("PhysObj not found!")}_repelForceCalculation(t){for(const e of this.nodeObjList)e!==t&&t.repel(e,this.repelForce)}_updateObject(t,e){t.nullifyForce(),this._repelForceCalculation(t),t.update(e)}update(t){isNaN(t)||R().forEach(this.nodeObjList,(e=>this._updateObject(e,t)))}doNSteps(t,e=.016){for(let s=0;s<t;++s)this.update(e)}get nodeObjList(){return R().values(this.objects)}dispose(){this.objects={}}}var $=s(39),Y=s.n($);class U extends d.Object3D{constructor(t,e=20,s=-45){super(),this.text=t;const o=this.label=new F.xv;o.font=l.Font.Main,o.fontSize=10,o.scale.set(e,e,e),o.color=16777215,o.fillOpacity=.5,o.anchorX="center",o.anchorY="middle",o.text=t,o.sync(),o.rotateX(d.MathUtils.degToRad(s)),this.t=o,this.add(o),this.animDuration=500,this.animDistance=1500,this.easeType=Y().Easing.Back.Out}animateIn(){this.t.position.z=this.animDistance,this.t.material.opacity=0,new(Y().Tween)(this.t.position).to({z:0},this.animDuration).easing(this.easeType).start(),new(Y().Tween)(this.t.material).to({opacity:1},this.animDuration).easing(this.easeType).start()}animateOut(t=!1){const e=5*this.animDuration;new(Y().Tween)(this.t.position).to({z:5*-this.animDistance},e).easing(this.easeType).start(),new(Y().Tween)(this.t.material).to({opacity:0},e).easing(this.easeType).start().onComplete((()=>{t&&this.parent.remove(this)}))}}class G{constructor(t){this.scene=t,this.labels=[]}handleObject(t){}makeLabel(t,e,s=20){if(!t)return;const o=new U(t,s);return o.position.copy(e),this.scene.add(o),this.labels.push(o),o}onEnter(){this.labels.forEach((t=>t.animateIn()))}onLeave(){this.labels.forEach((t=>t.animateOut(!0))),this.labels=[]}update(t){}}class q{constructor(t,e=0,s=0,o=0,i=-1,n=0){this.position=t,this.constCoeff=e,this.linearCoeff=s,this.quadraticCoeff=o,this.radius=i,this.relaxRadius=n}applyForceToDistance(t,e,s){const o=t.realObject.position,i=this.constCoeff+e*this.linearCoeff+e*e*this.quadraticCoeff;t.force.add(s.clone().sub(o).normalize().multiplyScalar(i))}applyForce(t){const e=t.realObject.position,s=this.position.distanceTo(e),o=this.radius<=0;(o||s<=this.radius)&&s>this.relaxRadius&&this.applyForceToDistance(t,s,this.position)}}class W extends q{constructor(t,e=0,s=0,o=0){const i=P.centerOf(R().flatten(t));super(new d.Vector3(i.x,i.y,0),e,s,o,0,0),this.triangles=t,this.center=i}get allSectors(){const t=[];for(const e of this.triangles)t.push(new k(e[0],e[1])),t.push(new k(e[1],e[2])),t.push(new k(e[2],e[0]));return t}applyForce(t){if(!this.triangles||!this.triangles.length)return;const e=t.realObject.position,s={x:e.x,y:e.y},o=R().some(this.triangles,(t=>P.pointInTriangle(s,t)));if(o)return;const i=R().minBy(this.allSectors,(t=>t.pDistance(s.x,s.y))),n=i.nearestPoint(s.x,s.y),r=new k(n,s).length;this.applyForceToDistance(t,r,new d.Vector3(n.x,n.y,0))}}class X{static original(){return[[{x:0,y:0},{x:133,y:-133},{x:-238,y:-291}],[{x:0,y:0},{x:-133,y:135},{x:291,y:311}]]}static triangles(t=0,e=0,s=1){const o=[];for(const i of this.original()){const n=[];for(const{x:o,y:r}of i)n.push({x:o*s+t,y:r*s+e});o.push(n)}return o}}class K extends G{constructor(t){super(t),this._circleRadius=350;const e=l.Physics.BaseForce;this.tcAttractor=new W(X.triangles(0,100,1.8),e)}handleObject(t){super.handleObject(t),t.attractors=[this.tcAttractor]}onEnter(){this.makeLabel("THORChain",new d.Vector3(0,-580,-100),18),super.onEnter()}}const Z="*";class Q extends G{constructor(t){super(t),this._circleRadius=350,this._sideDistance=600;const e=l.Physics.BaseForce;this.attractors={[j.Active]:[new q(new d.Vector3(0,0,0),e,0,0,0,this._circleRadius)],[j.Standby]:[new q(new d.Vector3(-this._sideDistance,0,0),e,0,0,0,.3*this._circleRadius),new q(new d.Vector3(-this._sideDistance,0,0),.02*e)],[Z]:[new q(new d.Vector3(this._sideDistance,0,0),e,0,0,0,.3*this._circleRadius),new q(new d.Vector3(this._sideDistance,0,0),.02*e)]}}handleObject(t){super.handleObject(t),t.attractors=[];const e=this.attractors[t.node.status];t.attractors=e||this.attractors[Z]}onEnter(){this.makeLabel("Active",new d.Vector3(0,-500,0),20),this.makeLabel("Standby",new d.Vector3(-this._sideDistance,-400,0),12),this.makeLabel("Other",new d.Vector3(this._sideDistance,-400,0),12),super.onEnter()}}class J extends L{constructor(t,e,s,o,i,n){super(),this.name=o,this.position=new d.Vector3(t,e,0),this._radius=s,this.attractors=[i],this.friction=n}get radius(){return this._radius}}class tt{constructor(t,e,s=600,o=.02,i=1){this.force=t,this.boundRadius=e,this.cicles=[],this.iterSteps=i,this.dt=.05,this.simulation=new H,this.simulation.repelForce=s,this.friction=o,this.metaAttractor=new q(new d.Vector3,this.force,0,0,-1,0)}addCircle(t,e){this.cicles.push({name:t,radius:e})}arrangeAroundCenter(){if(!this.cicles.length)return this;const t=2*Math.PI/this.cicles.length,e=.5*this.boundRadius*.8;let s=0;for(const{name:o,radius:i}of this.cicles)this.simulation.addObject(o,new J(e*Math.cos(s),e*Math.sin(s),i,o,this.metaAttractor,this.friction)),s+=t;return this}clear(){this.cicles=[],this.simulation.dispose()}pack(t,e){return this.cicles.length?(t=t||this.dt,e=e||this.iterSteps,this.simulation.doNSteps(e,t),this):this}getResults(){const t={};for(const[e,s]of R().entries(this.simulation.objects))t[e]={position:s.position,radius:s.radius};return t}}Math.pow(10,8);function et(t){t=t.toUpperCase();for(const e of t.split("-"))if("AS"!==e)return e;return t}const st="UNKNOWN";class ot extends G{constructor(t){super(t),this._attractorBanish=new q(new d.Vector3(0,0,0),-100),this.attractors={},this.force=l.Physics.BaseForce,this.circlePacker=new tt(this.force,1200,300,.02,1)}createProviderAttractors(t){const e={};for(const s of t){const t=s.ipInfo,o=et(t?t.asname:st),i=e[o]??0;e[o]=i+1}this.circlePacker.clear(),this.attractors={};for(const[s,o]of R().entries(e)){const t=100*Math.sqrt(+o);console.log(s,t),this.circlePacker.addCircle(s,t),this.attractors[s]=new q(new d.Vector3,this.force,0,0,0,20*Math.sqrt(+o))}this.circlePacker.arrangeAroundCenter(),this._transferAttractorsPositionFromPacker(),this._makeLabels()}_makeLabels(){const t=this.circlePacker.getResults();for(const[e,{position:s}]of R().entries(t))this.makeLabel(e,new d.Vector3(s.x,s.y-150,200),5)}_transferAttractorsPositionFromPacker(){const t=this.circlePacker.getResults();for(const[e,{position:s}]of R().entries(t)){const t=this.attractors[e];t?t.position.copy(s):console.warn(`no attr for ${e}`)}}update(){this._transferAttractorsPositionFromPacker()}handleObject(t){if(super.handleObject(t),!t)return;let e=et(t.ipInfo&&t.ipInfo.asname?t.ipInfo.asname:st);t.attractors=[this.attractors[e]??this._attractorBanish]}}const it=Object.freeze({Normal:"normal",Status:"status",Provider:"provider"});class nt extends H{constructor(t){super(),this._currentIdent=0,this.parent=t,this._modeNormal=new K(this.parent),this._modeStatus=new Q(this.parent),this._modeProvider=new ot(this.parent),this._selectedModeHandler=this._modeNormal,this.mode=it.Normal,this._startPositionBounds={xMin:-60,xMax:60,yMin:-40,yMax:40,zMin:0,zMax:0}}genIdent(t){return t.node_address??String(this._currentIdent++)}_placeNodeObject(t){const e=O.randomOnCircle(2e3);t.o.position.copy(e),this.parent.add(t.o)}createNewNode(t){const e=this.genIdent(t),s=this.getByName(e);if(s)return console.warn("NodeObject already exists. No nothing"),s;console.info(`Create node ${e}.`);const o=new z(t);return this.parent.add(o.o),this._placeNodeObject(o),this.addObject(e,o),o}destroyNode(t){const e=t.node_address??t,s=this.getByName(e);s?(console.info(`Destroy node ${e}.`),s.dispose(),this.parent.remove(s.o),super.removeObject(e)):console.error("node not found!")}set mode(t){this._mode=t,this._selectedModeHandler.onLeave(),this._mode===it.Normal?this._selectedModeHandler=this._modeNormal:this._mode===it.Status?this._selectedModeHandler=this._modeStatus:this._mode===it.Provider&&(this._modeProvider.createProviderAttractors(this.nodeObjList),this._selectedModeHandler=this._modeProvider),this._selectedModeHandler.onEnter(),console.log(`Set Mode: ${t}`)}_updateObject(t,e){this._selectedModeHandler.handleObject(t),super._updateObject(t,e)}reactEvent(t){const e=O.getRandomFloat(0,1e3*l.DataSource.ReactRandomDelay);setTimeout((()=>{const e=this.getByName(t.node.node_address);e&&(t.type===D.EVENT_TYPE.OBSERVE_CHAIN?e.reactChain():t.type===D.EVENT_TYPE.SLASH&&e.reactSlash())}),e)}update(t){return this._selectedModeHandler.update(t),super.update(t)}dispose(){super.dispose(),S(this.parent);for(const t of this.nodeObjList)t.dispose()}}var rt=s(6265),at=s.n(rt);class ct{constructor(t,e){this.period=e,this.url=t,this._isRunning=!1,this._timer=0,this.callback=()=>0}run(){this._isRunning?console.warn(`${this.toString()} is already running`):(this._isRunning=!0,console.info(`${this.toString()} started!`),this._tick().then(),this._timer=setInterval((()=>{this._tick().then()}),1e3*this.period))}stop(){this._isRunning&&(clearInterval(this._timer),this._timer=0,this._isRunning=!1,console.info(`${this.toString()} stopped.`))}toString(){return`URLDataSource(${this.url}, ${this.period} sec)`}get isRunning(){return this._isRunning}async _tick(){try{const t=await at().get(this.url,{headers:{"Content-type":"application/json"}});this.callback&&this.callback(t.data)}catch(t){throw console.error(`${this.toString()} tick failed: ${t}`),t}}}var ht=s(3461),dt=s.n(ht);class lt{constructor(t){this.status=t["status"],this.ipAddress=t["query"],this.message=t["message"],this.countryCode=t["countryCode"],this.region=t["region"],this.regionName=t["regionName"],this.city=t["city"],this.lat=t["lat"],this.lon=t["lon"],this.isp=t["isp"],this.org=t["org"],this.asname=t["asname"]}}class ut{constructor(t=1440){this.expireMinutes=t}url(t){return`http://ip-api.com/json/${t}?fields=status,message,countryCode,region,regionName,city,lat,lon,isp,org,asname,query`}async loadFromService(t){const e=await at().get(this.url(t));return console.info(`Loaded IP info for (${t}) => ${e.data.status}`),new lt(e.data)}loadFromCache(t){return dt().get("IPInfo:"+t)}saveToCache(t){if(!t||!t.ipAddress)return void console.warn("no data to save!");const e=t.ipAddress;dt().set("IPInfo:"+e,t,this.expireMinutes)}async load(t){let e=this.loadFromCache(t);return e||(e=await this.loadFromService(t),this.saveToCache(e),e)}}class pt{constructor(t,e){this.scene=t,this.vueComp=e,this.prevNodes=[],this.nodes=[],this._makeSomeLight(),this.nodeGroup=new nt(this.scene),this._runDataSource()}_runDataSource(){this.dataSource=new ct(l.DataSource.NodesURL,l.DataSource.PollPeriod),this.dataSource.callback=t=>{this.handleData(t)},this.dataSource.run(),this.ipAddressLoader=new ut}_makeSomeLight(){const t=new d.DirectionalLight("hsl(0, 100%, 100%)");t.position.set(0,10,1e3),this.scene.add(t);const e=new d.AmbientLight(4210752);this.scene.add(e)}async _loadAdditionalInfoAbout(t){const e=t.node.ip_address;e&&(t.ipInfo=await this.ipAddressLoader.load(e))}handleData(t){console.info("Handle Data tick!"),this.prevNodes=this.nodes,this.nodes=t;const e=new N(this.prevNodes,this.nodes),s=e.extractEvents();for(const o of s){const t=o.node;if(t.node_address)if(o.type===D.EVENT_TYPE.CREATE){const e=this.nodeGroup.createNewNode(t);this._loadAdditionalInfoAbout(e).then()}else o.type===D.EVENT_TYPE.DESTROY?this.nodeGroup.destroyNode(t):this.nodeGroup.reactEvent(o)}s.length&&this.vueComp.pokeActivity()}update(t){this.nodeGroup.update(t)}dispose(){this.dataSource.stop(),this.nodeGroup.dispose(),S(this.scene)}}var mt={name:"MainScreen",components:{FPSCounter:M},props:{},data(){return{showFps:!0,nodes:[],prevNodes:[],mouseEnterX:0,mouseEnterY:0,sceneMode:"normal"}},methods:{onKeyDown(t){"KeyR"===t.code?this.resetCamera():"KeyD"===t.code?this.showFps=!this.showFps:"KeyH"===t.code&&console.log("help?")},onMouseMove(t){const e=t.clientX,s=t.clientY;if(!this.mouseEnterX)return this.mouseEnterX=e,void(this.mouseEnterY=s);const o=5e-4,i=this.mouseEnterX-e,n=this.mouseEnterY-s;this.mouseEnterX=e,this.mouseEnterY=s,this.controls.rotate(i*o,n*o)},onMouseEnter(t){this.mouseEnterX=t.clientX,this.mouseEnterY=t.clientY},onMouseLeave(){},resetCamera(){this.controls.reset()},resizeRendererToDisplaySize(){const t=this.renderer,e=t.domElement,s=e.clientWidth,o=e.clientHeight;this.camera.aspect=s/o,this.camera.updateProjectionMatrix();const i=e.width!==s||e.height!==o;return i&&(t.setSize(s,o,!1),this.bloomPass&&this.bloomPass.setSize(s,o),this.composer.setSize(s,o)),i},render(){this.resizeRendererToDisplaySize(this.renderer);const t=this.clock.getDelta();this.$refs.fps.update(t,this.scene),this.controls.update(t),this.content.update(t),Y().update(),this.composer.render(t),requestAnimationFrame(this.render)},createCamera(){this.camera=new d.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.001,2*l.Controls.Camera.Distance.Max),this.camera.position.z=l.Controls.Camera.Distance.Start},createCameraControl(){const t=this.controls=new p.Z(this.camera,this.renderer.domElement),e=l.Controls.Camera;t.dragToOffset=!0,t.minDistance=e.Distance.Min,t.maxDistance=e.Distance.Max,this.camera.position.z=e.Distance.Start,t.minAzimuthAngle=d.MathUtils.degToRad(-e.AzimuthAngleLimit),t.maxAzimuthAngle=d.MathUtils.degToRad(e.AzimuthAngleLimit),t.minPolarAngle=d.MathUtils.degToRad(90-e.PolarAngleLimit),t.maxPolarAngle=d.MathUtils.degToRad(e.PolarAngleLimit+90),t.update(0)},makeSkybox(){const t=l.Scene.Sky.SkyBox,e=l.Scene.Sky.SkyBoxExt,s=R().map([`right.${e}`,`left.${e}`,`top.${e}`,`bottom.${e}`,`front.${e}`,`back.${e}`],(e=>`${t}/${e}`));this.scene.background=(new d.CubeTextureLoader).load(s)},makeRenderer(t){let e=this.renderer=new d.WebGLRenderer({canvas:t,antialias:!1,logarithmicDepthBuffer:!0});devicePixelRatio&&(console.log(`Renderer: Setting devicePixelRatio = ${devicePixelRatio}.`),e.setPixelRatio(devicePixelRatio));const s=new f.C(this.scene,this.camera);this.composer=new m.xC(e),this.composer.addPass(s);const o=l.Effects.Bloom;o.Enabled&&(this.bloomPass=new g.m(new d.Vector2(window.innerWidth,window.innerHeight),o.Strength,o.Radius,o.Threshold),this.composer.addPass(this.bloomPass))},buildScene(){this.scene.add(this.camera),this.makeSkybox(),this.content=new pt(this.scene,this)},setSceneMode(t){this.sceneMode=t,this.content.nodeGroup&&(this.content.nodeGroup.mode=t)},isButtonSelectedClass(t){return{"button-selected":this.sceneMode===t}},pokeActivity(){this.$refs.fps.pokeActivity()}},mounted(){this.canvas=this.$refs.canvas,this.clock=new d.Clock,this.scene=new d.Scene,this.createCamera(this.canvas),this.makeRenderer(this.canvas),this.createCameraControl(),this.resizeRendererToDisplaySize(),this.buildScene(),requestAnimationFrame(this.render)},unmounted(){this.content.dispose(),this.controls.dispose()}};const ft=(0,x.Z)(mt,[["render",h]]);var gt=ft,yt={name:"App",components:{MainScreen:gt},data(){return{}},computed:{},created(){document.title="THORViz",this.preloading()},methods:{preloading(){(0,F.C5)({font:l.Font.Main,characters:"abcdefghijklmnopqrstuvwxyz1234567890"},(()=>{console.log("font loading done")}))}}};const _t=(0,x.Z)(yt,[["render",n]]);var vt=_t,bt=s(1373);p.Z.install({THREE:d});const St=(0,bt.Z)(),wt=(0,o.ri)(vt);wt.config.globalProperties.emitter=St,wt.mount("#app")}},e={};function s(o){var i=e[o];if(void 0!==i)return i.exports;var n=e[o]={id:o,loaded:!1,exports:{}};return t[o].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=t,function(){var t=[];s.O=function(e,o,i,n){if(!o){var r=1/0;for(d=0;d<t.length;d++){o=t[d][0],i=t[d][1],n=t[d][2];for(var a=!0,c=0;c<o.length;c++)(!1&n||r>=n)&&Object.keys(s.O).every((function(t){return s.O[t](o[c])}))?o.splice(c--,1):(a=!1,n<r&&(r=n));if(a){t.splice(d--,1);var h=i();void 0!==h&&(e=h)}}return e}n=n||0;for(var d=t.length;d>0&&t[d-1][2]>n;d--)t[d]=t[d-1];t[d]=[o,i,n]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var o in e)s.o(e,o)&&!s.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,o){var i,n,r=o[0],a=o[1],c=o[2],h=0;if(r.some((function(e){return 0!==t[e]}))){for(i in a)s.o(a,i)&&(s.m[i]=a[i]);if(c)var d=c(s)}for(e&&e(o);h<r.length;h++)n=r[h],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return s.O(d)},o=self["webpackChunkthorviz"]=self["webpackChunkthorviz"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=s.O(void 0,[998],(function(){return s(7513)}));o=s.O(o)})();
//# sourceMappingURL=app.45a05482.js.map