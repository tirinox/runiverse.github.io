(function(){"use strict";var e={6046:function(e,t,s){var n=s(9242),o=s(3396);function i(e,t,s,n,i,r){const a=(0,o.up)("MainScreen");return(0,o.wg)(),(0,o.j4)(a)}const r={class:"container"},a={class:"canvas-container"},c={class:"ui-container"};function l(e,t,s,i,l,d){const h=(0,o.up)("FPSCounter"),u=(0,o.up)("LoadingIndicator"),p=(0,o.up)("ControlPanel"),m=(0,o.up)("NodeDetailsWindow");return(0,o.wg)(),(0,o.iD)("div",r,[(0,o._)("div",a,[(0,o._)("canvas",{ref:"canvas",class:"canvas-full",tabindex:"1",onKeypress:t[0]||(t[0]=(0,n.iM)(((...e)=>d.onKeyDown&&d.onKeyDown(...e)),["prevent"])),onMousemove:t[1]||(t[1]=(...e)=>d.onMouseMove&&d.onMouseMove(...e)),onMouseenter:t[2]||(t[2]=(...e)=>d.onMouseEnter&&d.onMouseEnter(...e)),onMouseleave:t[3]||(t[3]=(...e)=>d.onMouseLeave&&d.onMouseLeave(...e)),onClick:t[4]||(t[4]=(0,n.iM)(((...e)=>d.onClick&&d.onClick(...e)),["prevent"]))},null,544),(0,o.wy)((0,o.Wm)(h,{ref:"fps"},null,512),[[n.F8,l.showFps]]),l.isLoading?((0,o.wg)(),(0,o.j4)(u,{key:0})):(0,o.kq)("",!0),l.fullyLoaded?((0,o.wg)(),(0,o.j4)(p,{key:1,onModeSelected:d.setSceneMode},null,8,["onModeSelected"])):(0,o.kq)("",!0)]),(0,o._)("div",c,[((0,o.wg)(),(0,o.j4)(o.Ob,null,[l.nodeDetailsVisible?((0,o.wg)(),(0,o.j4)(m,{key:0,node:l.nodeToViewDetails,"node-set":l.nodeSet,onClose:d.onCloseDetails},null,8,["node","node-set","onClose"])):(0,o.kq)("",!0)],1024))])])}var d=s(1114);const h=!0,u={DataSource:{NodesURL:h?"https://thornode.ninerealms.com":"http://localhost:8080/data/samplenodes.json",Nodes:{PollPeriod:3e3},LastBlock:{PollPeriod:1e4},ReactRandomDelay:500,NodeJuggler:{Enabled:!1}},Font:{Main:"fonts/Exo2-VariableFont_wght.ttf"},Effects:{Bloom:{Enabled:!0,Strength:.9,Threshold:.5,Radius:1.2}},Controls:{Camera:{Distance:{Min:800,Max:2900,Start:2e3},AzimuthAngleLimit:180,PolarAngleLimit:180,MouseMoveStrength:2e-4,Animation:{Duration:500,DistanceWhenZoomed:300,Shift:{X:-200}}}},Scene:{InitialMode:"normal",Background:{Enabled:!0},Sky:{SkyBox:"texture/skybox/star",SkyBoxExt:"png"},NodeObject:{Simple:!1,PlaneScale:1,MinRadius:12,MaxScale:80,MinScale:10,ScaleFactor:1,RadiusFactor:.3},Globe:{Enabled:!0,Details:64,Radius:600,NodeElevation:20,TextureMap:"texture/globe/2k_earth_nightmap.jpeg",Clouds:{ElevationScale:1.005,Opacity:.05,Texture:"texture/globe/earth_atmo.jpeg"},Atmosphere:{ElevationScale:1.15},InnerAtmosphere:{Enabled:!0}}},Physics:{BaseForce:3500,RepelForce:2e3,Startup:{SimulationSteps:10,DeltaTime:.1},BaseFriction:.07,MaxSpeedSq:Math.pow(15e3,2),Attractor:{Flat:{DeltaZ:1}}},Debug:{ShowFPS:!1},Renderer:{LogZBuffer:!0}},p={LightningBlue:52479,YggdrasilGreen:3407769,MidgardTurqoise:2350280,NightBlack:1055009};var m=s(2071),v=s(2338),f=s(9868),g=s(7139);const y={class:"fps-counter"},_={class:"activity"};function b(e,t,s,i,r,a){return(0,o.wg)(),(0,o.iD)("div",y,[(0,o._)("span",null,[(0,o._)("strong",null,(0,g.zw)(Number(r.fps).toFixed(2)),1),(0,o.Uk)(" FPS, "+(0,g.zw)(r.objCount)+" objects",1)]),(0,o.wy)((0,o._)("span",_,"•",512),[[n.F8,r.activityIndicator]])])}function S(e){let t=0;return e.traverse((function(){t++})),t}function w(e){e&&e.remove.apply(e,e.children)}function x(e,t,s=1){const n=Math.PI*(.5-t/180),o=Math.PI*(.5+e/180),i=new d.Spherical(s,n,o);return(new d.Vector3).setFromSpherical(i)}function k(e,t){const s=e.x-t.x,n=e.y-t.y;return Math.sqrt(s*s+n*n)}var P=s(1373);const A={FullyLoaded:"fully_loaded",DataSourceTick:"data_source_tick",Activity:"activity"},T=(0,P.Z)();var E={name:"FPSCounter",props:{updatePeriod:{type:Number,default:1}},data(){return{fps:0,objCount:0,activityIndicator:!1,lastUpdateTime:0}},methods:{pokeActivity(){this.activityIndicator=!0,setTimeout((()=>{this.activityIndicator=!1}),100)},update(e,t){e>0&&+Date.now()-1e3*this.updatePeriod>this.lastUpdateTime&&(this.fps=1/e,this.objCount=S(t),this.lastUpdateTime=+Date.now())}},unmounted(){T.off(A.Activity,this.pokeActivity)},mounted(){T.on(A.Activity,this.pokeActivity)}},C=s(89);const M=(0,C.Z)(E,[["render",b],["__scopeId","data-v-27eb1626"]]);var O=M,N=s(4806),D=s.n(N),z=s(9172),R=s.n(z);function I(e,t){return void 0===e?t:e}class B{static getRandomInt(e){return Math.floor(Math.random()*e)}static getRandomFloat(e,t){return Math.random()*(t-e)+e}static getRandomSample(e){if(!e)return null;const t=B.getRandomInt(e.length);return e[t]}static removeRandomItem(e){if(Math.random()>.5){const t=B.getRandomInt(e.length);e.splice(t,1)}return e}static randomVector({xMin:e,xMax:t,yMin:s,yMax:n,zMin:o,zMax:i}){return e=I(+e,-10),t=I(+t,10),s=I(+s,-10),n=I(+n,10),o=I(+o,-10),i=I(+i,10),new d.Vector3(B.getRandomFloat(e,t),B.getRandomFloat(s,n),B.getRandomFloat(o,i))}static randomOnCircle(e=100,t=0,s=0){const n=B.getRandomFloat(0,2*Math.PI);return new d.Vector3(t+e*Math.cos(n),s+e*Math.sin(n))}static getRandomIntRange(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}}class j{constructor(e,t){this.p1=e,this.p2=t}get dx(){return this.p2.x-this.p1.x}get dy(){return this.p2.y-this.p1.y}whichSide(e,t){const s=e-this.p1.x,n=t-this.p1.y,o=this.dx,i=this.dy;return Math.sign(s*o-n*i)}get center(){return{x:.5*(this.p1.x+this.p2.x),y:.5*(this.p1.y+this.p2.y)}}nearestPoint(e,t){const s=e-this.p1.x,n=t-this.p1.y,o=this.dx,i=this.dy,r=s*o+n*i,a=o*o+i*i;let c=-1;return 0!==a&&(c=r/a),c<0?(e=this.p1.x,t=this.p1.y):c>1?(e=this.p2.x,t=this.p2.y):(e=this.p1.x+c*o,t=this.p1.y+c*i),{x:e,y:t}}pDistance(e,t){const s=this.nearestPoint(e,t);return new j(s,{x:e,y:t}).length}get length(){const e=this.dx,t=this.dy;return Math.sqrt(e*e+t*t)}}class F{static clamp(e,t,s){return Math.min(+s,Math.max(+t,+e))}static centerOf(e){if(!e||!e.length)return;let t=D().sumBy(e,(e=>e.x)),s=D().sumBy(e,(e=>e.y));return{x:t/e.length,y:s/e.length}}static _signHelper(e,t,s){return(e.x-s.x)*(t.y-s.y)-(t.x-s.x)*(e.y-s.y)}static pointInTriangle(e,t){const[s,n,o]=t,i=F._signHelper(e,s,n),r=F._signHelper(e,n,o),a=F._signHelper(e,o,s),c=i<0||r<0||a<0,l=i>0||r>0||a>0;return!(c&&l)}}function L(e,t=2,s=""){return R()(e).format({average:!0,mantissa:t})+s}const V="Rune";function U(e,t=2){return L(e,t," "+V)}var G=s(2378);class H{constructor(){this.mass=1,this.force=new d.Vector3,this.velocity=new d.Vector3,this.friction=0,this.attractors=[]}update(e){this.attractors.forEach?this.attractors.forEach((e=>e.applyForce(this))):this.attractors.applyForce&&this.attractors.applyForce(this);const t=this.force.multiplyScalar(this.mass);this.velocity.copy(this.velocity.clone().add(t.multiplyScalar(e))),this.velocity.multiplyScalar(F.clamp(1-this.friction,0,1)),this.velocity.lengthSq()>u.Physics.MaxSpeedSq&&this.velocity.setLength(Math.sqrt(u.Physics.MaxSpeedSq)),this.realObject.position.add(this.velocity.clone().multiplyScalar(e))}nullifyForce(){this.force.set(0,0,0)}get radius(){return 1}applyForceTo(e,t){this.force.add(e.copy().multiplyScalar(t))}get realObject(){return this}repel(e,t=100){if(e===this)return;const s=this.realObject.position,n=e.realObject.position,o=s.distanceTo(n),i=this.radius+e.radius;if(o<i){const o=s.clone().sub(n).normalize().multiplyScalar(t);this.force.add(o),e.force.add(o.negate())}}get boundingBox(){const e=this.realObject.position.x,t=this.realObject.position.y,s=this.radius;return{minX:e-s,minY:t-s,maxX:e+s,maxY:t+s}}shootOut(e=1){const t=this.o.position.clone().normalize().multiplyScalar(e);this.velocity.copy(t)}}var q="#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\nvarying float vIsPerspective;\n#else\nuniform float logDepthBufFC;\n#endif\n#endif\n\n// optional: pass 2D rotation angle as an uniform\nuniform float rotation;\n// optional: pass 2D center point as an uniform\nuniform vec2 center;\n\nvarying vec2 vUv;\n\n// optional: use this define to scale the model according to distance from the camera\n#define USE_SIZEATTENUATION\n\n// [skipped includes]\n\nvoid main() {\n    vUv = uv;\n\n    // discard rotation and scale\n    vec4 mvPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\n\n    // extract model's scale\n    vec2 scale;\n    scale.x = length(vec3(modelMatrix[0].x, modelMatrix[0].y, modelMatrix[0].z));\n    scale.y = length(vec3(modelMatrix[1].x, modelMatrix[1].y, modelMatrix[1].z));\n\n    // if not defined, keep model the same size regardless of distance from the camera\n    #ifndef USE_SIZEATTENUATION\n    bool isPerspective = isPerspectiveMatrix(projectionMatrix);\n    if (isPerspective) scale *= - mvPosition.z;\n    #endif\n\n    // if center is not passed as uniform, create vec2 center = vec2(0.0);\n\n    // aligned with the camera [and scaled]\n    vec2 alignedPosition = (position.xy - center) * scale;\n\n    // if rotation is not passed as uniform, skip the next block\n\n    // rotate 2D\n    vec2 rotatedPosition;\n    rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n    rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n    // billboard\n    mvPosition.xy += rotatedPosition;\n\n    gl_Position = projectionMatrix * mvPosition;\n\n    // [skipped includes]\n    #ifdef USE_LOGDEPTHBUF\n        #ifdef USE_LOGDEPTHBUF_EXT\n    vFragDepth = 1.0 + gl_Position.w;\n//    vIsPerspective = float(isPerspectiveMatrix(projectionMatrix));\n    vIsPerspective = 1.0;\n        #else\n//    if (isPerspectiveMatrix(projectionMatrix)) {\n        gl_Position.z = log2(max(EPSILON, gl_Position.w + 1.0)) * logDepthBufFC - 1.0;\n        gl_Position.z *= gl_Position.w;\n//    }\n        #endif\n    #endif\n}",$="// port from http://glslsandbox.com/e#8625.0 by Duke\n// Fireball\n// Awd\n// @AlexWDunn\n\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\nuniform float logDepthBufFC;\nvarying float vFragDepth;\nvarying float vIsPerspective;\n#endif\n\nuniform float time;\nuniform float saturation;\nuniform vec3 color;\n\nvarying vec2 vUv;\n\n#define saturate(oo) clamp(oo, 0.0, 1.0)\n\n// Quality Settings\n#define MarchSteps 5\n// Scene Settings\n#define ExpPosition vec3(0.0)\n#define Radius 1.0\n#define Background vec4(0.0, 0.0, 0.0, 0.0)\n// Noise Settings\n#define NoiseSteps 1\n#define NoiseAmplitude 0.06\n//#define NoiseFrequency 4.0\n#define NoiseFrequency 2.0\n#define Animation vec3(0.0, -3.0, 0.5)\n\n// Colour Gradient\n#define Color1 vec4(1.0, 1.0, 1.0, 1.0)\n#define Color2 vec4(0.2, 0.8, 1.0, 1.0)\n#define Color3 vec4(0.2, 0.03, 1.0, 1.0)\n#define Color4 vec4(0.05, 0.02, 0.02, 0.3)\n\nconst float zoom = 2.8f;// 2.5 full\n\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }\nvec4 taylorInvSqrt(vec4 r){ return 1.79284291400159 - 0.85373472095314 * r; }\n\nfloat snoise(vec3 v)\n{\n    const vec2  C = vec2(1.0/6.0, 1.0/3.0);\n    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n    // First corner\n    vec3 i  = floor(v + dot(v, C.yyy));\n    vec3 x0 = v - i + dot(i, C.xxx);\n    // Other corners\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min(g.xyz, l.zxy);\n    vec3 i2 = max(g.xyz, l.zxy);\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy;// 2.0*C.x = 1/3 = C.y\n    vec3 x3 = x0 - D.yyy;// -1.0+3.0*C.x = -0.5 = -D.y\n    // Permutations\n    i = mod289(i);\n    vec4 p = permute(permute(permute(i.z + vec4(0.0, i1.z, i2.z, 1.0)) + i.y + vec4(0.0, i1.y, i2.y, 1.0)) + i.x + vec4(0.0, i1.x, i2.x, 1.0));\n    // Gradients: 7x7 points over a square, mapped onto an octahedron.\n    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n    float n_ = 0.142857142857;// 1.0/7.0\n    vec3  ns = n_ * D.wyz - D.xzx;\n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);//  mod(p,7*7)\n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_);// mod(j,N)\n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n    vec4 b0 = vec4(x.xy, y.xy);\n    vec4 b1 = vec4(x.zw, y.zw);\n    vec4 s0 = floor(b0) * 2.0 + 1.0;\n    vec4 s1 = floor(b1) * 2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n    vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy;\n    vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww;\n    vec3 p0 = vec3(a0.xy, h.x);\n    vec3 p1 = vec3(a0.zw, h.y);\n    vec3 p2 = vec3(a1.xy, h.z);\n    vec3 p3 = vec3(a1.zw, h.w);\n    //Normalise gradients\n    vec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    // Mix final noise value\n    vec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot(m*m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3)));\n}\n\nfloat Turbulence(vec3 position, float minFreq, float maxFreq, float qWidth)\n{\n    float value = 0.0;\n    float cutoff = clamp(0.5/qWidth, 0.0, maxFreq);\n    float fade;\n    float fOut = minFreq;\n    for (int i=NoiseSteps; i>=0; i--)\n    {\n        if (fOut >= 0.5 * cutoff) break;\n        fOut *= 2.0;\n        value += abs(snoise(position * fOut))/fOut;\n    }\n    fade = clamp(2.0 * (cutoff-fOut)/cutoff, 0.0, 1.0);\n    value += fade * abs(snoise(position * fOut))/fOut;\n    return 1.0-value;\n}\n\nfloat SphereDist(vec3 position)\n{\n    return length(position - ExpPosition) - Radius;\n}\n\nvec4 Shade(float distance)\n{\n    float c1 = clamp(distance*5.0 + 0.5, 0.0, 1.0);\n    float c2 = clamp(distance*5.0, 0.0, 1.0);\n    float c3 = clamp(distance*3.4 - 0.5, 0.0, 1.0);\n\n    //    #define Color1 vec4(1.0, 1.0, 1.0, 1.0)   -- white\n    //    #define Color2 vec4(0.2, 0.8, 1.0, 1.0) --- green\n    //    #define Color3 vec4(0.2, 0.03, 1.0, 1.0)  -- blue\n    //    #define Color4 vec4(0.05, 0.02, 0.02, 0.3) -- black transparent\n\n    vec4 original = vec4(color, 1.0);\n    vec4 a = mix(Color1, Color3, c1);\n    vec4 b = mix(a, Color4, c2);\n    return mix(original, b, c3);\n}\n\n// Draws the scene\nfloat RenderScene(vec3 position, out float distance)\n{\n    float noise = Turbulence(position * NoiseFrequency + Animation*time, 0.1, 1.5, 0.03) * NoiseAmplitude;\n    noise = clamp(abs(noise), 0.0, 1.0);\n    distance = SphereDist(position) - noise;\n    return noise;\n}\n\n// Basic ray marching method.\nvec4 March(vec3 rayOrigin, vec3 rayStep)\n{\n    vec3 position = rayOrigin;\n    float distance;\n    float displacement;\n    for (int step = MarchSteps; step >=0; --step)\n    {\n        displacement = RenderScene(position, distance);\n        if (distance < 0.05) break;\n        position += rayStep * distance;\n    }\n    return mix(Shade(displacement), Background, float(distance >= 0.5));\n}\n\nbool IntersectSphere(vec3 ro, vec3 rd, vec3 pos, float radius, out vec3 intersectPoint)\n{\n    vec3 relDistance = (ro - pos);\n    float b = dot(relDistance, rd);\n    float c = dot(relDistance, relDistance) - radius*radius;\n    float d = b*b - c;\n    intersectPoint = ro + rd*(-b - sqrt(d));\n    return d >= 0.0;\n}\n\nconst float circleThickness = 0.15;\nconst float circleRadius = 0.78;\n\nvoid main()\n{\n    vec2 p = vUv * 2.0 - 1.0;\n\n//    gl_FragColor = vec4(1.0, 1.0, 1.0, length(p) < 1.0 ?  1.0 : 0.0);\n//    return;\n\n    float rotx = 0.0;\n    float roty = 0.0;\n\n    // camera\n    vec3 ro = zoom * normalize(vec3(cos(roty), cos(rotx), sin(roty)));\n    vec3 ww = normalize(vec3(0.0, 0.0, 0.0) - ro);\n    vec3 uu = normalize(cross(vec3(0.0, 1.0, 0.0), ww));\n    vec3 vv = normalize(cross(ww, uu));\n    vec3 rd = normalize(p.x*uu + p.y*vv + 1.5 * ww);\n//    vec3 rd = normalize(p.x*uu + p.y*vv + zoom_f * ww);\n    vec4 col = Background;\n    vec3 origin;\n    if (IntersectSphere(ro, rd, ExpPosition, Radius + NoiseAmplitude * 6.0, origin))\n    {\n        col = March(origin, rd);\n    }\n\n    if(saturation > 1.0) {\n        float d = length(p);\n        //  1.0 - smoothstep(radius-borderThickness, radius, d);\n        float t = 1.0 - smoothstep(0.0, circleRadius, abs(circleThickness - d));\n        col = mix(col * saturation, vec4(0.9, 0.9, 1.0, 0.5), clamp(t, 0.0, 0.5));\n    }\n\n    gl_FragColor = col;\n\n    #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n    // Doing a strict comparison with == 1.0 can cause noise artifacts\n    // on some platforms. See issue #17623.\n    gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n    #endif\n}\n";const W=Object.freeze({CREATE:"create",DESTROY:"destroy",SLASH:"slash",IP_ADDRESS:"ip_address",STATUS:"status",VERSION:"version",FORCED_LEAVE:"forced_to_leave",REQUESTED_LEAVE:"requested_to_leave",AWARD:"current_award",BOND_CHANGE:"bond",OBSERVE_CHAIN:"observe_chains",ACTIVE_BLOCK_HEIGHT:"active_block_height"});class Y{constructor(e,t,s,n,o){this.type=e,this.node=t,this.prevNode=s,this.currValue=n,this.prevValue=o,this.isTramp=!!t&&""===t.address}toString(){const e=this.node?this.node.address:"?";return`NodeEvent(${this.type}, ${e}, ${this.currValue} => ${this.prevValue})`}}function X(e){return void 0===e||null===e||isNaN(e)}Y.EVENT_TYPE=W;class Z{constructor(e,t,s){this.x=e,this.y=t,this.z=s}static fromString(e){const t=D().map(e.split("."),(e=>parseInt(e))),s=t.length,n=t[0],o=s>1?t[1]:0,i=s>2?t[2]:0;return new Z(n,o,i)}get isInvalid(){return X(this.x)||X(this.y)||X(this.z)}greater(e){return this.x>e.x||this.y>e.y||this.z>e.z}less(e){return this.x<e.x||this.y<e.y||this.z<e.z}equal(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}toString(){return`${this.x}.${this.y}.${this.z}`}inc(e=10,t=10){return this.z++,this.z>=e&&(this.z=0,this.y++,this.y>=t&&(this.x++,this.y=0)),this}}const K={Standby:"Standby",Whitelisted:"Whitelisted",Disabled:"Disabled",Active:"Active",Unknown:"Unknown"};class Q{constructor(e,t){this.prev=e,this.curr=t}extractEvents(){const e=[],t=(t,s,n,o)=>{o=o||"address",e.push(new Y(t,s,n,s?s[o]:"",n?n[o]:""))},s=D().difference(this.curr.nameSet,this.prev.nameSet);for(const a of s){const e=this.curr.byAddress[a];t(Y.EVENT_TYPE.CREATE,e,e)}const n=D().difference(this.prev.nameSet,this.curr.nameSet);for(const a of n){const e=this.prev.byAddress[a];t(Y.EVENT_TYPE.DESTROY,e,e)}const o=Y.EVENT_TYPE,i={slashPoints:o.SLASH,bond:o.BOND_CHANGE,IPAddress:o.IP_ADDRESS,status:o.STATUS,height:o.ACTIVE_BLOCK_HEIGHT,currentAward:o.AWARD,observeChains:o.OBSERVE_CHAIN,version:o.VERSION},r=D().intersection(this.curr.nameSet,this.prev.nameSet);for(const a of r){const e=this.prev.byAddress[a],s=this.curr.byAddress[a],n=D().union(D().keys(e),D().keys(s)),o=D().filter(n,(t=>!D().isEqual(e[t],s[t])));for(const r of o){const n=i[r];n&&t(n,s,e,r)}}return e}}class J{constructor(e=10){this.tick=1,this.period=e,this.enabled=!0,this.juggleStatus=!0,this.juggleVersion=!0}handleNodes(e){return this.enabled&&(this.tick%this.period===0&&(e=this._juggleNodes(e)),this.tick++),e}_juggleNodes(e){return this.juggleStatus&&(e=this._juggleNodesStatus(e)),this.juggleVersion&&(e=this._juggleNodesVersion(e)),e}_juggleNodesStatus(e){const t=B.getRandomIntRange(2,7),s=B.getRandomIntRange(2,7);return console.warn(`Attention! _juggleNodes: IN: ${t}, OUT: ${s}!`),e.filteredByStatus(K.Active).sampleRandomly(s).setStatusAll(K.Standby),e.filteredByStatus(K.Standby).sampleRandomly(t).setStatusAll(K.Active),e}_nextVersion(e){return Z.fromString(e).inc(10,100).toString()}_juggleNodesVersion(e){const t=B.getRandomIntRange(1,5);return e.sampleRandomly(t).nodes.forEach((e=>{const t=e.version;e.version=this._nextVersion(e.version),console.warn(`Debug upgrade ${e.shortAddress}: ${t} => ${e.version}`)})),e}}var ee=s(7627),te=s(6550);function se(e,t){return(0,te.B$)(e,Object.assign({vertexMainOutro:"\n                    vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n                    vec3 scale = vec3(\n                      length(modelViewMatrix[0].xyz),\n                      length(modelViewMatrix[1].xyz),\n                      length(modelViewMatrix[2].xyz)\n                      );\n                    // size attenuation: scale *= -mvPosition.z * 0.2;\n                    mvPosition.xyz += position * scale;\n                    gl_Position = projectionMatrix * mvPosition;\n                    "},t))}const ne=u.Scene.NodeObject,oe=ne.PlaneScale,ie=new d.BoxGeometry(oe,oe,oe),re=new d.SphereGeometry(.5*ne.PlaneScale,10,10),ae=16724736,ce=2.42;class le extends H{constructor(e){super(),this.node=e,this.normalizedBond=this.node.bond/1e6,this.mass=this.normalizedBond+1,this.o=new d.Group,this.o.name=this.name,this.attractors=[],this.friction=u.Physics.BaseFriction,this._makeSphere(),this._makeLabel(),this._elevated=!1}get name(){return this.node.address}set elevated(e){e=Boolean(e),this._elevated!==e&&(this._elevated=e,this.material.uniforms.saturation.value=this._elevated?1.5:1,this.material.uniformsNeedUpdate=!0)}get elevated(){return this._elevated}_getSphereColor(){let e=1118481;const t=this.node.status;return t===K.Standby?e=1473110:t===K.Active?e=B.getRandomSample([p.LightningBlue,p.YggdrasilGreen]):t===K.Disabled?e=15597568:t===K.Whitelisted?e=4473924:t===K.Unknown&&(e=1118532),new d.Color(e)}_makeSphere(){this.mesh&&(this.o.remove(this.mesh),this.mesh=null),u.Scene.NodeObject.Simple?this._makeSimpleSphere():this._makeCoolSphere();const e=this.calculateScale;let t=(0,ee.Qy)(-.1,.1);this.mesh.name=this.name,this.mesh.renderOrder=1,this.mesh.scale.setScalar(e),this.mesh.position.z=t,this.o.renderOrder=1,this.o.add(this.mesh)}_makeSimpleSphere(){this.mesh=new d.Mesh(re,new d.MeshBasicMaterial({color:this._getSphereColor()}))}_makeCoolSphere(){return this.material=new d.ShaderMaterial({uniforms:{time:{value:B.getRandomFloat(0,100)},saturation:{value:1},color:{value:this._getSphereColor()}},vertexShader:q,fragmentShader:$,transparent:!0,depthTest:!0,depthWrite:!0}),this.mesh=new d.Mesh(ie,this.material),this.mesh}get calculateScale(){const e=this.normalizedBond*ne.MaxScale;return F.clamp(e,ne.MinScale,ne.MaxScale)}get realObject(){return this.o}get position(){return this.o.position}_makeLabel(){const e=this.node.address;if(e&&e.length>=4){const t=this.nameTextObj=new G.xv;t.text=e.slice(-4),t.font=u.Font.Main,t.fontWeight=900,t.fontSize=15,t.position.z=ce,t.color=this.node.status===K.Active?16777215:12303291,t.anchorX="center",t.anchorY="middle",t.outlineWidth=2,t.sync(),t.renderOrder=100,t.name=this.name,t.material=se(new d.MeshBasicMaterial),t.scale.setScalar((0,N.clamp)(1.1*this.normalizedBond,.5,1.5)),this.o.add(t),this.labelObj=t}}dispose(){this.nameTextObj&&this.nameTextObj.dispose(),this.material.dispose()}get radius(){return Math.max(ne.MinRadius,this.mesh.scale.x*ne.PlaneScale*ne.RadiusFactor)}static estimateRadiusOfGroup(e){let t=0;for(const i of e)t+=i.radius;const s=e.length,n=t>0?t/s:0,o=n*Math.sqrt(s);return Math.max(.1,o)}update(e){super.update(e),this.material&&(this.material.uniforms.time.value+=e)}react(e){this.node=e.node,e.type===Y.EVENT_TYPE.OBSERVE_CHAIN?this.reactChain():e.type===Y.EVENT_TYPE.SLASH?this.reactSlash():e.type===Y.EVENT_TYPE.STATUS&&this.reactStatusChange(e.node.status)}reactChain(){const e=this.o.position.clone().normalize(),t=e.cross(new d.Vector3(0,0,1)).multiplyScalar(100);this.velocity.add(t)}reactSlash(){const e=100;this.shootOut(e);const t=this.material.uniforms.color.value.clone();this.material&&(this.material.uniforms.color.value.set(ae),this.material.uniformsNeedUpdate=!0,setTimeout((()=>{this.material.uniforms.color.value.set(t),this.material.uniformsNeedUpdate=!0}),100))}reactStatusChange(e){console.log(`New status ${this.node.status} -> ${e}`),this._makeSphere()}}var de=s(5325),he=s.n(de);class ue{constructor(){this._objects={},this.repelForce=0,this.rBush=new(he()),this.repelEnabled=!0}getByName(e){return this._objects[e]}addObject(e,t){const s=this.getByName(e);if(s)return console.warn("PhysObj already exists. No nothing"),s;this._objects[e]=t}removeObject(e){const t=this.getByName(e);t?(t.dispose(),delete this._objects[e]):console.error("PhysObj not found!")}_repelForceCalculation(e){let t=this.rBush.search(e.boundingBox);for(const s of t)s.o!==e&&e.repel(s.o,this.repelForce)}_updateObject(e,t){e.nullifyForce(),this.repelEnabled&&this._repelForceCalculation(e),e.update(t)}update(e){isNaN(e)||(this.rBush=new(he()),this.rBush.load(D().map(D().values(this._objects),(e=>({...e.boundingBox,o:e})))),D().forEach(D().values(this._objects),(t=>this._updateObject(t,e))))}doNSteps(e,t=.016){for(let s=0;s<e;++s)this.update(t)}get physicalObjects(){return D().values(this._objects)}get objectPositions(){return D().map(this.physicalObjects,"position")}get allNames(){return D().keys(this._objects)}dispose(){this._objects={},this.rBush.clear()}get size(){return D().size(this._objects)}get entries(){return D().entries(this._objects)}}var pe=s(39),me=s.n(pe);class ve extends d.Object3D{constructor(e,t=20,s=-45,n=!1){super(),this.text=e;const o=this.label=new G.xv;o.font=u.Font.Main,o.fontSize=10,o.scale.set(t,t,t),o.color=16777215,o.fillOpacity=1,o.anchorX="center",o.anchorY="middle",o.text=e,n&&(o.material=se(new d.MeshBasicMaterial({transparent:!0}))),o.rotateX(d.MathUtils.degToRad(s)),o.sync(),this.t=o,this.add(o),this.animDuration=500,this.animDistance=1500,this.easeType=me().Easing.Back.Out}animateIn(){this.t.position.z=this.animDistance,this.t.material.opacity=0,new(me().Tween)(this.t.position).to({z:0},this.animDuration).easing(this.easeType).start(),new(me().Tween)(this.t.material).to({opacity:1},this.animDuration).easing(this.easeType).start()}animateOut(e=!1){const t=5*this.animDuration;new(me().Tween)(this.t.position).to({z:5*-this.animDistance},t).easing(this.easeType).start(),new(me().Tween)(this.t.material).to({opacity:0},.5*t).easing(this.easeType).start().onComplete((()=>{e&&this.parent&&this.parent.remove(this)}))}}class fe{constructor(e){this.scene=e,this.labels=[],this.active=!1,this.isFlat=!0}handleObject(e){}reactEvent(e,t){}makeLabel(e,t,s=20,n=-45,o=!1){if(!e)return;const i=new ve(e,s,n,o);return i.position.copy(t),this.scene.add(i),this.labels.push(i),i}onEnter(){}_triggerOnEnter(e,t){this.onEnter(e,t),this.active=!0,this.labels.forEach((e=>e.animateIn()))}onLeave(){}_triggerOnLeave(e,t){this.onLeave(e,t),this.active=!1,this.clearLabels()}clearLabels(){this.labels.forEach((e=>e.animateOut(!0))),this.labels=[]}update(e){}}class ge{constructor(e,t=0,s=0,n=0,o=-1,i=0){this.position=e,this.constCoeff=t,this.linearCoeff=s,this.quadraticCoeff=n,this.radius=o,this.relaxRadius=i}applyForceToDistance(e,t,s){const n=e.realObject.position,o=this.getForce(t,n,s);e.force.add(o)}getForce(e,t,s){const n=this.constCoeff+e*this.linearCoeff+e*e*this.quadraticCoeff;return s.clone().sub(t).normalize().multiplyScalar(n)}distance(e){const t=e.realObject.position;return this.position.distanceTo(t)}applyForce(e){const t=this.distance(e),s=this.radius<=0;(s||t<=this.radius)&&t>this.relaxRadius&&this.applyForceToDistance(e,t,this.position)}}ge.INFINITE=-1;class ye extends ge{distance(e){return k(this.position,e.realObject.position)}applyForce(e){super.applyForce(e),this.squishZ(e)}squishZ(e){const t=e.realObject.position.z-this.position.z;let s=0;Math.abs(t)>1&&(s=100*-t),e.force.z=s}}class _e extends ye{constructor(e,t=0,s=0,n=0,o=0){const i=F.centerOf(D().flatten(e));super(new d.Vector3(i.x,i.y,0),t,s,n,0,0),this.triangles=e,this.center=i,this.z=o}get allSectors(){const e=[];for(const t of this.triangles)e.push(new j(t[0],t[1])),e.push(new j(t[1],t[2])),e.push(new j(t[2],t[0]));return e}applyForce(e){if(!this.triangles||!this.triangles.length)return;const t=e.realObject.position,s={x:t.x,y:t.y},n=D().some(this.triangles,(e=>F.pointInTriangle(s,e)));if(this.squishZ(e),n)return;const o=D().minBy(this.allSectors,(e=>e.pDistance(s.x,s.y))),i=o.nearestPoint(s.x,s.y),r=new j(i,s).length;this.applyForceToDistance(e,r,new d.Vector3(i.x,i.y,this.z))}}class be{static original(){return[[{x:0,y:0},{x:133,y:-133},{x:-238,y:-291}],[{x:0,y:0},{x:-133,y:135},{x:291,y:311}]]}static triangles(e=0,t=0,s=1){const n=[];for(const o of this.original()){const i=[];for(const{x:n,y:r}of o)i.push({x:n*s+e,y:r*s+t});n.push(i)}return n}}class Se extends fe{constructor(e){super(e),this._circleRadius=350;const t=u.Physics.BaseForce;this.tcAttractor=new _e(be.triangles(0,100,1.8),t)}handleObject(e){e.attractors=this.tcAttractor}onEnter(e){const t=this.makeLabel("THORChain",new d.Vector3(0,-580,-10),18);t.t.opacity=.8,super.onEnter(),e.forEach((e=>{e.velocity.add(new d.Vector3(0,B.getRandomFloat(100,1e3),0))}))}}const we="*";class xe extends fe{constructor(e){super(e),this._circleRadius=350,this._sideDistance=600;const t=u.Physics.BaseForce;this.tcAttractor=new _e(be.triangles(0,100,1.6),t),this.attractors={[K.Active]:[this.tcAttractor],[K.Standby]:[new ge(new d.Vector3(-this._sideDistance,0,0),t,0,0,0,.3*this._circleRadius),new ge(new d.Vector3(-this._sideDistance,0,0),.02*t)],[we]:[new ge(new d.Vector3(this._sideDistance,0,0),t,0,0,0,.3*this._circleRadius),new ge(new d.Vector3(this._sideDistance,0,0),.02*t)]}}handleObject(e){e.attractors=null;const t=this.attractors[e.node.status];e.attractors=t||this.attractors[we]}onEnter(e){const t=D().countBy(e,"node.status"),s=t[K.Standby],n=t[K.Active],o=e.length-(s+n);this.makeLabel("Active",new d.Vector3(0,-500,0),20),this.makeLabel("Standby",new d.Vector3(-this._sideDistance,-420,0),12),this.makeLabel("Other",new d.Vector3(this._sideDistance,-420,0),12),this.makeLabel(n,new d.Vector3(0,-650,0),10,-45),this.makeLabel(s,new d.Vector3(-this._sideDistance,-500,0),6,-45),this.makeLabel(o,new d.Vector3(this._sideDistance,-500,0),6,-45),super.onEnter()}}class ke extends H{constructor(e,t,s,n,o,i){super(),this.name=n,this.position=new d.Vector3(e,t,0),this._radius=s,this.attractors=o,this.friction=i}get radius(){return this._radius}}const Pe=u.Physics.BaseFriction;class Ae{constructor(e,t,s=600,n=Pe,o=1){this.force=e,this.boundRadius=t,this.iterSteps=o,this.dt=.05,this.simulation=new ue,this.simulation.repelForce=s,this.friction=n,this.metaAttractor=new ge(new d.Vector3,this.force,0,0,-1,0)}addCircle(e,t){this.simulation.addObject(e,new ke(0,0,t,e,this.metaAttractor,this.friction))}arrangeAroundCenter(){if(!this.simulation.size)return this;const e=2*Math.PI/this.simulation.size,t=.5*this.boundRadius*.8;let s=.5*Math.PI;for(const n of this.simulation.allNames){const o=this.simulation.getByName(n);o&&(o.position.x=t*Math.cos(s),o.position.y=t*Math.sin(s)),s-=e}return this}clear(){this.simulation.dispose()}pack(e,t){return this.simulation.size?(e=e||this.dt,t=t||this.iterSteps,this.simulation.doNSteps(t,e),this):this}getResults(){const e={};for(const[t,{position:s,radius:n}]of this.simulation.entries)e[t]={position:s,radius:n};return e}}var Te=s(6265),Ee=s.n(Te),Ce=s(3461),Me=s.n(Ce);class Oe{constructor(e){this.ipAddress=e["ip"],this.countryCode=e["country_code"],this.country=e["country_name"],this.city=e["city"],this.latitude=e["latitude"],this.longitude=e["longitude"],this.providerName=e["org"],this.flag=Oe.getFlagEmoji(this.countryCode)}static getFlagEmoji(e){if(e){const t=e.toUpperCase().split("").map((e=>127397+e.charCodeAt()));return String.fromCodePoint(...t)}return""}}const Ne="UNKNOWN";class De{constructor(e=1440){this.expireMinutes=e,this._key="IPInfo2"}url(e){return`https://settings.thornode.org/api/node/ip/${e}`}async loadFromService(e){const t=await Ee().get(this.url(e));return console.info(`Loaded IP info for (${e}) => ${t.status}`),new Oe(t.data)}loadFromCache(e){return Me().get(`${this._key}:${e}`)}saveToCache(e){if(!e||!e.ipAddress)return void console.warn("no data to save!");const t=e.ipAddress;Me().set(`${this._key}:${t}`,e,this.expireMinutes)}async load(e){let t=this.loadFromCache(e);return t||(t=await this.loadFromService(e),this.saveToCache(t),t)}static refineProviderName(e){if(void 0===e)return Ne;e=e.toUpperCase(),e=e.replace("ONLINE GMBH","");for(const t of e.split("-"))if("AS"!==t)return t;return e}}class ze extends fe{constructor(e){super(e),this._attractorBanish=new ge(new d.Vector3(0,0,0),-100),this.attractors={},this.force=u.Physics.BaseForce,this.circlePacker=new Ae(this.force,1400,300,.02,1)}update(){this._transferAttractorsPositionFromPacker()}handleObject(e){if(e){let t=De.refineProviderName(e?.node?.IPInfo?.providerName??Ne);e.attractors=this.attractors[t]??this._attractorBanish}}onEnter(e){this._createProviderAttractors(e),super.onEnter()}_createProviderAttractors(e){const t={};let s=null,n=0;for(const i of e){const e=i?.node?.IPInfo?.providerName??Ne,o=De.refineProviderName(e);if(t[o]){const e=t[o];e.push(i),e.length>n&&(s=o,n=e.length)}else t[o]=[i]}this.circlePacker.clear(),this.attractors={};const o=D().sortBy(D().entries(t),[e=>e[1].length]);for(const[i,r]of o)i!==s&&this._makeAttractor(i,r,!0);this.circlePacker.arrangeAroundCenter(),this._transferAttractorsPositionFromPacker(),s&&this._makeAttractor(s,t[s],!1),this._makeLabels(t,s)}_makeAttractor(e,t,s){const n=.9*le.estimateRadiusOfGroup(t);return s&&this.circlePacker.addCircle(e,n),this.attractors[e]=new ge(new d.Vector3,this.force,0,0,0,n),n}_makeLabelForGroup(e,t,s){const n=e[t].length,o=`${t} (${n})`;this.makeLabel(o,new d.Vector3(s.x,s.y-180,60),5)}_makeLabels(e,t){const s=this.circlePacker.getResults();for(const[n,{position:o}]of D().entries(s))this._makeLabelForGroup(e,n,o);t&&this._makeLabelForGroup(e,t,new d.Vector3)}_transferAttractorsPositionFromPacker(){const e=this.circlePacker.getResults();for(const[t,{position:s}]of D().entries(e)){const e=this.attractors[t];e?e.position.copy(s):console.warn(`no attr for ${t}`)}}}class Re extends fe{constructor(e){super(e),this._circleRadius=350,this._sideDistance=600,this.force=u.Physics.BaseForce,this.attractors={},this.circlePacker=new Ae(this.force,1200,300,u.Physics.BaseFriction,1),this._attractorBanish=new ge(new d.Vector3(0,0,0),-100)}reactEvent(e,t){e.type===Y.EVENT_TYPE.VERSION&&(this.attractors[e.currValue]||(console.log(`New version detected: ${e.currValue}`),this.clearLabels(),this._createVersionAttractors(t)))}handleObject(e){if(e){let t=e.node.version;e.attractors=this.attractors[t]??this._attractorBanish}}onEnter(e){this._createVersionAttractors(e),this.makeLabel("Versions",new d.Vector3(0,-630,-10),14)}_createVersionAttractors(e){const t={};let s="",n=[];for(const i of e){const e=i.node.version;if(""===e)continue;t[e]||(t[e]=[]);const o=t[e];o.push(i),o.length>n.length&&(n=o,s=e)}this.circlePacker.clear(),this.attractors={};for(const[i,r]of D().sortBy(D().entries(t),[e=>e[0]])){const e=le.estimateRadiusOfGroup(r);this.attractors[i]=new ge(new d.Vector3,this.force,0,0,0,e),i!==s&&this.circlePacker.addCircle(i,e)}this.circlePacker.arrangeAroundCenter();const o=le.estimateRadiusOfGroup(n);this.circlePacker.addCircle(s,o),this._transferAttractorsPositionFromPacker(),this._makeLabels()}_makeLabels(){const e=this.circlePacker.getResults();for(const[t,{position:s}]of D().entries(e)){const e=this.attractors[t];if(e){const n="0.0.0"===t?"Unknown":`v. ${t}`;this.makeLabel(n,new d.Vector3(s.x,s.y-1.1*e.relaxRadius-20,50),2.5)}}}_transferAttractorsPositionFromPacker(){const e=this.circlePacker.getResults();for(const[t,{position:s}]of D().entries(e)){const e=this.attractors[t];e?e.position.copy(s):console.warn(`no attr for ${t}`)}}}class Ie extends fe{constructor(e){super(e),this.nameToAttractor={},this.force=u.Physics.BaseForce,this.center=new d.Vector3(0,120),this._noBondAttractor=new ge(this.center,this.force)}handleObject(e){e.attractors=this.nameToAttractor[e.node.address]}onEnter(e){const t=this.makeLabel("Bonds",new d.Vector3(0,-630,-10),14);t.t.opacity=.8,e=D().sortBy(e,"node.bond");const s=e.length;this.nameToAttractor={},0!==s&&(this._positionateOnSpiral(e),super.onEnter())}_positionateOnSpiral(e){const t=e.length;let s=0,n=34;const o=1.5;let i=5.9,r=.5;const a=.995,c=.991;for(let l=0;l<t;++l){const t=this.center.x+o*n*Math.cos(s),d=this.center.y+n*Math.sin(s);this._addAttractor(e[l],t,d)&&(n+=i,s+=r,i*=a,r*=c)}}_positionateOnGrid(e){const t=e.length,s=Math.ceil(Math.sqrt(t)),n=Math.ceil(t/s),o=100,i=s*o,r=n*o,a=.5*i,c=.5*r;for(let l=0;l<t;++l){const t=l%s,n=Math.floor(l/s),i=o*t-a,r=o*n-c;this._addAttractor(e[l],i,r)}}_addAttractor(e,t,s){const n=e.node.bond;if(n>1){const o=0;return this.nameToAttractor[e.node.address]=new ge(new d.Vector3(t,s,o),this.force,0,0,-1,10),this.makeLabel(U(n),new d.Vector3(t,s-e.radius-10,-10),1),!0}return this.nameToAttractor[e.node.address]=this._noBondAttractor,!1}}var Be="//uniform float time;\n//uniform float saturation;\n//uniform vec3 color;\n\nvarying vec2 vUv;\nvarying vec3 vNormal;\n\nconst vec3 ATMO_COLOR = vec3(0.3, 0.6, 1.0);\nconst vec3 FORWARD = vec3(0.0, 0.0, 1.0);\n\nuniform sampler2D globeTexture;\n\nvoid main(void) {\n    float intensity = 1.05 - dot(vNormal, FORWARD);\n    vec3 atmo = clamp(ATMO_COLOR * pow(intensity, 1.5), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n//    vec3 atmo = vec3(0.0, 0.0, 0.0);\n    gl_FragColor = vec4(atmo + texture2D(globeTexture, vUv).xyz, 1.0);\n    //    gl_FragColor = texture2D(globeTexture, vUv);\n}\n\n",je="varying vec2 vUv;\nvarying vec3 vNormal;\n\nvoid main()\n{\n    vUv = uv;\n    vNormal = normalMatrix * normalize(normal);\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n}";class Fe extends fe{constructor(e){super(e),this.isFlat=!1,this.force=1.2*u.Physics.BaseForce,this._banishAttractor=new ge(new d.Vector3(0,0,0),this.force),this._nameToAttractor={},this._coordToAttractor={}}handleObject(e){const t=this._nameToAttractor[e.name];e.attractors=t?[t]:[this._banishAttractor]}onEnter(e,t){super.onEnter(),t.repelEnabled=!1,this._createAttractorsStacked(e),u.Scene.Globe.Enabled&&(this._makeGlobe(),this._putInGlobe())}onLeave(e,t){this._destroyGlobe(),D().forEach(e,(e=>e.shootOut(2e3))),super.onLeave(),t.repelEnabled=!0}_makeGlobe(){if(this.globeMesh)return;const e=new d.TextureLoader,t=u.Scene.Globe,s=new d.SphereGeometry(t.Radius,t.Details,t.Details),n=new d.ShaderMaterial({name:"AtmosphereShaderMaterial",fragmentShader:Be,vertexShader:je,uniforms:{globeTexture:{value:e.load(u.Scene.Globe.TextureMap)}}});if(this.globeMesh=new d.Mesh(s,n),this.globeMesh.renderOrder=9999,this.scene.add(this.globeMesh),t.Clouds.Opacity>0){const n=new d.MeshPhongMaterial({map:e.load(t.Clouds.Texture),side:d.DoubleSide,opacity:t.Clouds.Opacity,transparent:!0,depthWrite:!1,blending:d.AdditiveBlending});this.cloudMesh=new d.Mesh(s,n),this.cloudMesh.scale.setScalar(t.Clouds.ElevationScale),this.globeMesh.add(this.cloudMesh),this.cloudMesh2=new d.Mesh(s,n),this.cloudMesh2.scale.setScalar(t.Clouds.ElevationScale),this.globeMesh.add(this.cloudMesh2)}}_putInGlobe(){this.globeMesh.scale.set(.01,.01,.01),new(me().Tween)(this.globeMesh.scale).to(new d.Vector3(1,1,1)).easing(me().Easing.Sinusoidal.InOut).start()}_destroyGlobe(){if(!this.globeMesh)return;const e=this.globeMesh;new(me().Tween)(e.scale).to(new d.Vector3(.01,.01,.01)).easing(me().Easing.Sinusoidal.InOut).onComplete((()=>{e.parent.remove(e)})).start(),this.globeMesh=null}update(e){super.update(e),this.cloudMesh&&(this.cloudMesh.rotation.y+=.02*e),this.cloudMesh2&&(this.cloudMesh2.rotation.y-=.04*e)}_createAttractors(e){const t=u.Scene.Globe.Radius+u.Scene.Globe.NodeElevation;this._nameToAttractor={},this._coordToAttractor={};for(const s of e){const e=s.node.IPInfo;if(e&&s.node.IPAddress){const n=`${e.longitude}, ${e.latitude}`;let o=this._coordToAttractor[n];if(!o){const s=x(e.longitude,e.latitude,t);o=this._coordToAttractor[n]=new ge(s,this.force,0,0,ge.INFINITE,5)}this._nameToAttractor[s.node.address]=o}else this._nameToAttractor[s.node.address]=this._banishAttractor}console.log(`Total attractors were made: ${this._coordToAttractor.length}.`)}_createAttractorsStacked(e){this._nameToAttractor={},this._coordToStack={};for(const s of e){const e=s.node.IPInfo;if(e&&s.node.IPAddress){const t=`${e.longitude}, ${e.latitude}`;let n=this._coordToStack[t];n||(this._coordToStack[t]=n={stack:[],longitude:e.longitude,latitude:e.latitude}),n.stack.push(s)}else this._nameToAttractor[s.node.address]=this._banishAttractor}const t=u.Scene.Globe.Radius+u.Scene.Globe.NodeElevation;for(const{stack:s,longitude:n,latitude:o}of D().values(this._coordToStack)){const e=D().sortBy(s,(e=>-e.node.bond));let i=t;for(const t of e){const e=x(n,o,i);this._nameToAttractor[t.node.address]=new ge(e,this.force,0,0,ge.INFINITE,5),i+=2.1*t.radius}}console.log(`Total attractors were made: ${this._coordToAttractor.length}.`)}}const Le=Object.freeze({Normal:"normal",Status:"status",Provider:"provider",Version:"version",Bond:"bond",Geo:"geo"});class Ve extends ue{constructor(e){super(),this.holder=new d.Group,e.add(this.holder),this._currentIdent=0,this.parent=e,this._modeNormal=new Se(this.parent),this._modeStatus=new xe(this.parent),this._modeProvider=new ze(this.parent),this._modeVersion=new Re(this.parent),this._modeBond=new Ie(this.parent),this._modeGeo=new Fe(this.parent),this._selector={[Le.Normal]:this._modeNormal,[Le.Status]:this._modeStatus,[Le.Provider]:this._modeProvider,[Le.Version]:this._modeVersion,[Le.Bond]:this._modeBond,[Le.Geo]:this._modeGeo},this._selectedModeHandler=this._modeNormal,this.mode=Le.Normal,this.repelForce=u.Physics.RepelForce}genIdent(e){return e.address??String(this._currentIdent++)}_placeNodeObject(e){const t=B.randomOnCircle(2e3);e.o.position.copy(t),this.holder.add(e.o)}createNewNode(e){const t=this.genIdent(e),s=this.getByName(t);if(s)return console.warn("NodeObject already exists. No nothing"),s;console.info(`Create node ${t}.`);const n=new le(e);return this._placeNodeObject(n),this.addObject(t,n),n}destroyNode(e){const t=e.address??e,s=this.getByName(t);s?(console.info(`Destroy node ${t}.`),s.dispose(),this.holder.remove(s.o),super.removeObject(t)):console.error("node not found!")}set mode(e){this._mode!==e&&(this._mode=e,this._selectedModeHandler._triggerOnLeave(this.physicalObjects,this),this._selectedModeHandler=this._selector[this._mode],this._selectedModeHandler._triggerOnEnter(this.physicalObjects,this),console.log(`Set Mode: ${e}`))}_updateObject(e,t){e&&(this._selectedModeHandler.handleObject(e),super._updateObject(e,t))}reactEvent(e){const t=B.getRandomFloat(0,u.DataSource.ReactRandomDelay);setTimeout((()=>{const t=this.getByName(e.node.address);t&&(t.react(e),this._selectedModeHandler.reactEvent(e,this.physicalObjects))}),t)}update(e){this._selectedModeHandler.update(e),super.update(e)}dispose(){super.dispose(),w(this.holder);for(const e of this.physicalObjects)e.dispose()}setElevatedNode(e){for(const t of this.physicalObjects)t.elevated=t.name===e}get isCurrentModeFlat(){return this._selectedModeHandler.isFlat}}const Ue=6,Ge=Math.pow(10,8),He=1/Ge;function qe(e){return parseFloat(e)*He}class $e{constructor(e,t=!0){this.nodes=e||[],this.total=this.nodes.length,t&&(this._nodesWithNames=D().filter(this.nodes,(e=>e.address)),this.byAddress=D().keyBy(this._nodesWithNames,"address"),this.nameSet=D().keys(this.byAddress),this.totalBond=D().sumBy(this.nodes,(e=>e.bond)),this.maxSlashNode=D().maxBy(this.nodes,(e=>e.slashPoints)),this.trampCount=this.total-this._nodesWithNames.length,this.maxAgeNode=D().maxBy(D().filter(this.nodes,(e=>e.activeBlockHeight&&e.activeBlockHeight>0)),(e=>e.activeBlockHeight)),this.ranks={bond:this._makeRanking("bond","desc"),slash:this._makeRanking("slashPoints"),age:this._makeRanking("activeBlockHeight"),award:this._makeRanking("currentAward")},this.topHeights=this.calculateTopBlockHeight(3),this.topVersion=this.calculateTopVersion())}_makeRanking(e,t="asc"){const s=D().orderBy(this._nodesWithNames,[e],[t]),n=D().map(s,"address"),o=Array.from(Array(s.length),((e,t)=>t+1));return Object.fromEntries(D().zip(n,o))}findByAddress(e){return this.byAddress[e]}sortedNodes(e,t=!0){const s=t?1:-1;return new $e(D().sortBy(this.nodes,(t=>s*t[e])))}filteredByStatus(e){return new $e(D().filter(this.nodes,(t=>t.status===e)))}get sortedByBond(){return this.sortedNodes("bond")}get sortedByAge(){return this.sortedNodes("statusSince")}sampleRandomly(e){return new $e(D().sampleSize(this.nodes,e))}setStatusAll(e){D().forEach(this.nodes,(t=>t.status=e))}bondPercentOfTotal(e){return(e/this.totalBond*100).toFixed(2)}get length(){return this.total}_calculateTopBlockOneChain(e,t){const s=D().map(Object.keys(t),(e=>parseInt(e)));s.sort().reverse();for(const n of s){const s=t[n];if(s>=e)return n}return null}calculateTopBlockHeight(e=2){const t=Array.from(new Set(D().flatten(D().map(this._nodesWithNames,(e=>D().keys(e.observeChains)))))),s=D().map(t,(e=>D().countBy(this._nodesWithNames,(t=>t.observeChains[e]??0))));return D().zipObject(t,D().map(t,((t,n)=>this._calculateTopBlockOneChain(e,s[n]))))}calculateTopVersion(){if(0===this.nodes.length)return null;let e=Z.fromString(this.nodes[0].version);for(let t=1;t<this.nodes.length;++t){const s=Z.fromString(this.nodes[t].version);s.greater(e)&&(e=s)}return e.toString()}estimateTimestampAtBlock(e,t){const s=e-t;return Date.now()-s*Ue*1e3}}class We{constructor(e){if(e||(e={status:"Unknown",jail:{},bond_providers:{},preflight_status:{}}),this.address=e.node_address,this.status=e.status,this.bond=qe(e.bond),this.activeBlockHeight=+e.active_block_height,this.bondAddress=e.bond_address,this.statusSince=+e.status_since,this.requestedToLeave=!!e.requested_to_leave,this.forcedToLeave=!!e.forced_to_leave,this.leaveHeight=+e.leave_height,this.IPAddress=e.ip_address,this.version=e.version,this.slashPoints=+e.slash_points,this.jail={address:e.jail.node_address,releaseHeight:+e.jail.release_height,reason:e.jail.reason},this.currentAward=qe(e.current_award),this.observeChains={},e["observe_chains"])for(let{chain:t,height:s}of e["observe_chains"])this.observeChains[t]=+s;if(this.preflightStatus={status:e.preflight_status.status,reason:e.preflight_status.reason,code:+e.preflight_status.code},this.bondProviders={address:e.bond_providers["node_address"],fee:+e.bond_providers["node_operator_fee"]/1e4,providers:[]},e.bond_providers.providers)for(let{bond_address:t,bond:s}of e.bond_providers.providers)this.bondProviders.providers.push({bond_address:t,bond:qe(s)});this.shortAddress=this.address?this.address.substring(this.address.length-4):"?",this.IPInfo={flag:"🏳️"}}}class Ye{constructor(e,t){this.period=t,this.baseUrl=e,this._isRunning=!1,this._timer=0,this.callback=()=>0,this.ipAddressLoader=new De}run(){this._isRunning?console.warn(`${this.toString()} is already running`):(this._isRunning=!0,console.info(`${this.toString()} started!`),this._tick().then(),this._timer=setInterval((()=>{this._tick().then()}),this.period))}stop(){this._isRunning&&(clearInterval(this._timer),this._timer=0,this._isRunning=!1,console.info(`${this.toString()} stopped.`))}toString(){return`URLDataSource(${this.baseUrl}, ${this.period} sec)`}get isRunning(){return this._isRunning}async dataProcess(e){return e}get url(){return this.baseUrl}async _tick(){try{const e=await Ee().get(this.url,{headers:{"Content-type":"application/json"}});if(this.callback){const t=await this.dataProcess(e.data);this.callback(t)}}catch(e){throw console.error(`${this.toString()} tick failed: ${e}`),e}}}class Xe extends Ye{get url(){return this.baseUrl+"/thorchain/nodes"}async dataProcess(e){const t=new $e(D().map(e,(e=>new We(e))));for(const n of t.nodes)if(n.IPAddress)try{n.IPInfo=await this.ipAddressLoader.load(n.IPAddress)}catch(s){console.error(`failed to load IPInfo for ${n.IPAddress}`)}return t}}class Ze extends Ye{get url(){return this.baseUrl+"/thorchain/lastblock"}async dataProcess(e){const t={};for(const s of e)t["THOR"]=+s["thorchain"],t[s["chain"]]=+s["last_observed_in"];return t}}const Ke={lastBlock:{THOR:0},lastNodes:[]};class Qe{constructor(e){this.scene=e,this.prevNodes=new $e([],!1),this.nodes=new $e([],!1),this.nodeGroup=new Ve(this.scene),this._firstTime=!0,this._runDataSource(),this._fullyLoaded=!1,this._nodeJuggler=new J(3),this._nodeJuggler.enabled=u.DataSource.NodeJuggler.Enabled}_runDataSource(){const e=u.DataSource.NodesURL;this.nodeDataSource=new Xe(e,u.DataSource.Nodes.PollPeriod),this.nodeDataSource.callback=this.handleData.bind(this),this.nodeDataSource.run(),this.lastBlockSource=new Ze(e,u.DataSource.LastBlock.PollPeriod),this.lastBlockSource.callback=e=>{Ke.lastBlock=e},this.lastBlockSource.run()}handleData(e){if(!e)return void console.error("No nodes to handle!");this._fullyLoaded||(this._fullyLoaded=!0,T.emit(A.FullyLoaded)),e=this._nodeJuggler.handleNodes(e),Ke.lastNodes=e,T.emit(A.DataSourceTick,e),this.prevNodes=this.nodes,this.nodes=e;const t=new Q(this.prevNodes,this.nodes),s=t.extractEvents();console.info(`Handle Data tick! Total: ${s.length} events.`);for(const n of s){const e=n.node;e.address&&(n.type===Y.EVENT_TYPE.CREATE?this.nodeGroup.createNewNode(e):n.type===Y.EVENT_TYPE.DESTROY?this.nodeGroup.destroyNode(e):this.nodeGroup.reactEvent(n))}if(this._firstTime){for(let e=0;e<u.Physics.Startup.SimulationSteps;++e)this.nodeGroup.update(u.Physics.Startup.DeltaTime);this._firstTime=!1}s.length&&T.emit(A.Activity)}update(e){this.nodeGroup.update(e)}dispose(){this.nodeDataSource.stop(),this.lastBlockSource.stop(),this.nodeGroup.dispose(),w(this.scene)}findNodeByAddress(e){return this.nodes.byAddress[e]}pick(e){const t=this.findNodeByAddress(e);console.log(t)}}var Je='/*\n * Copyright 2014 Roman Bobniev (FatumR)\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvarying vec2 vUv;\nuniform float time;\n\n#define OCTAVES  8.0\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nfloat rand2(vec2 co){\n    return fract(cos(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\n// Rough Value noise implementation\nfloat valueNoiseSimple(vec2 vl) {\n    float minStep = 1.0;\n\n    vec2 grid = floor(vl);\n    vec2 gridPnt1 = grid;\n    vec2 gridPnt2 = vec2(grid.x, grid.y + minStep);\n    vec2 gridPnt3 = vec2(grid.x + minStep, grid.y);\n    vec2 gridPnt4 = vec2(gridPnt3.x, gridPnt2.y);\n\n    float s = rand2(grid);\n    float t = rand2(gridPnt3);\n    float u = rand2(gridPnt2);\n    float v = rand2(gridPnt4);\n\n    float x1 = smoothstep(0., 1., fract(vl.x));\n    float interpX1 = mix(s, t, x1);\n    float interpX2 = mix(u, v, x1);\n\n    float y = smoothstep(0., 1., fract(vl.y));\n    float interpY = mix(interpX1, interpX2, y);\n\n    return interpY;\n}\n\n\nfloat fractalNoise(vec2 vl) {\n    float persistance = 2.0;\n    float amplitude = 0.5;\n    float rez = 0.0;\n    vec2 p = vl;\n\n    for (float i = 0.0; i < OCTAVES; i++) {\n        rez += amplitude * valueNoiseSimple(p);\n        amplitude /= persistance;\n        p *= persistance;\n    }\n    return rez;\n}\n\nfloat complexFBM(vec2 p) {\n    float slow = time / 2.5;\n    float fast = time / .5;\n    vec2 offset1 = vec2(slow, 0.);// Main front\n    vec2 offset2 = vec2(sin(fast)* 0.1, 0.);// sub fronts\n\n    return\n    fractalNoise(p + offset1 + fractalNoise(\n    p + fractalNoise(\n    p + 2. * fractalNoise(p - offset2)\n    )\n    )\n    );\n}\n\nconst vec3 blueColor = vec3(0.029411765, 0.207843137, 0.250392157);\nconst vec3 blackColor2 = vec3(0.00803922, 0.0203921569, 0.015686275);\n\nvoid main() {\n    vec2 uv = vUv;\n    uv = uv * vec2(2.0, 0.5) - 1.0;\n\n    vec3 rez = mix(blackColor2, blueColor, complexFBM(uv));\n    gl_FragColor = vec4(rez, 1.0);\n}';const et=new d.PlaneBufferGeometry(2,2,1,1),tt="\t\nuniform vec4 uSize; \t\t//w h t l \nvarying vec2 vUv;\n\nvoid main(){\n\tvUv = uv;\n\tvec2 transformed = \n\t    position.xy * uSize.xy \n\t    - vec2(1.,-1.) + vec2( uSize.x ,  -uSize.y ) \n\t    + vec2( uSize.w , - uSize.z ) * 2.;\n\tgl_Position = vec4( transformed , 1. , 1. );\n}\n",st="\nvarying vec2 vUv;\nuniform sampler2D uTexture;\n// uniform float time;\n\nvoid main(){\n\tgl_FragColor = texture2D( uTexture , vUv );\n}\t\n";class nt extends d.Mesh{constructor({width:e=1,height:t=1,top:s=0,left:n=0,texture:o=null,fragmentShader:i=!1}={}){super(et,new d.ShaderMaterial({uniforms:{uTexture:{type:"t",value:o},uSize:{type:"v4",value:new d.Vector4(1,1,0,0)},time:{value:0}},vertexShader:tt,fragmentShader:i||st,depthWrite:!1})),this.frustumCulled=!1,this.renderOrder=-1,this.top=s,this.left=n,this.width=e,this.height=t,this._pixels=[!1,!1,!1,!1],this._componentSetters=[this.setWidth,this.setHeight,this.setTop,this.setLeft],this._components=["width","height","top","left"],this.screenSize=new d.Vector2(1,1),this.setSize(e,t),this.setOffset(s,n)}update(e){this.material.uniforms.time.value+=e}setScreenSize(e,t){this.screenSize.set(e,t),this._pixels.forEach(((e,t)=>{e&&this._componentSetters[t].call(this,this[this._components[t]])}))}setSize(e,t){this.setWidth(e),this.setHeight(t)}setWidth(e){this.width=e,isNaN(e)?(this.material.uniforms.uSize.value.x=parseInt(e)/this.screenSize.x,this._pixels[0]=!0):(this.material.uniforms.uSize.value.x=e,this._pixels[0]=!1)}setHeight(e){this.height=e,isNaN(e)?(this.material.uniforms.uSize.value.y=parseInt(e)/this.screenSize.y,this._pixels[1]=!0):(this.material.uniforms.uSize.value.y=e,this._pixels[1]=!1)}setOffset(e,t){this.setLeft(t),this.setTop(e)}setTop(e){this.top=e,isNaN(e)?(this.material.uniforms.uSize.value.z=parseInt(e)/this.screenSize.y,this._pixels[2]=!0):(this.material.uniforms.uSize.value.z=e,this._pixels[2]=!1)}setLeft(e){this.left=e,isNaN(e)?(this.material.uniforms.uSize.value.w=parseInt(e)/this.screenSize.x,this._pixels[3]=!0):(this.material.uniforms.uSize.value.w=e,this._pixels[3]=!1)}}class ot{constructor(e){this.scene=e}install(){}update(e){}setSize(e,t){}}class it extends ot{constructor(e){super(e),this.quad=new nt({fragmentShader:Je})}install(){this.scene.add(this.quad)}update(e){this.quad.update(e)}setSize(e,t){this.quad&&this.quad.setScreenSize(e,t)}}const rt={class:"control-panel"},at=["onClick"];function ct(e,t,s,n,i,r){return(0,o.wg)(),(0,o.iD)("div",rt,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.modes,(e=>((0,o.wg)(),(0,o.iD)("button",{onClick:t=>r.setSceneMode(e.value),class:(0,g.C_)(r.isButtonSelectedClass(e.value)),key:e.value},(0,g.zw)(e.text),11,at)))),128))])}var lt={name:"ControlPanel",components:{},emits:["mode-selected"],props:{},data(){return{selectedMode:Le.Normal,activeOnly:!1}},computed:{modes(){return[{value:Le.Normal,text:"NORMAL"},{value:Le.Status,text:"STATUS"},{value:Le.Provider,text:"PROVIDER"},{value:Le.Version,text:"VERSION"},{value:Le.Bond,text:"BOND"},{value:Le.Geo,text:"GEO"}]}},methods:{isButtonSelectedClass(e){return{"button-selected":this.selectedMode===e}},setSceneMode(e){this.selectedMode=e,this.$emit("mode-selected",e)}},mounted(){u.Scene.InitialMode&&setTimeout((()=>this.setSceneMode(u.Scene.InitialMode)),1e3)}};const dt=(0,C.Z)(lt,[["render",ct],["__scopeId","data-v-19a2d274"]]);var ht=dt;const ut=(0,o._)("h1",null,"Node details",-1),pt={class:"prop-grid"},mt={class:"prop-box"},vt=(0,o._)("div",{class:"category"},"Status",-1),ft={class:"prop-box"},gt=(0,o._)("div",{class:"category"},"Since",-1),yt={class:"value"},_t={key:0,content:"The oldest active node"},bt=(0,o.Uk)("⌛"),St=[bt],wt={class:"prop-box"},xt=(0,o._)("div",{class:"category"},"💽 Version",-1),kt={class:"value"},Pt={key:0,content:"Latest version"},At=(0,o.Uk)("👌"),Tt=[At],Et={key:1,content:"Consider upgrading your node!"},Ct=(0,o.Uk)("⚠️"),Mt=[Ct],Ot={key:0,class:"prop-box"},Nt=(0,o._)("div",{class:"category"},"🕸️ IP address",-1),Dt={class:"value"},zt=["href"],Rt={key:1,class:"prop-box"},It=(0,o._)("div",{class:"category"},"📍 Location",-1),Bt={class:"value"},jt={key:2,class:"prop-box"},Ft=(0,o._)("div",{class:"category"},"☁️ Provider",-1),Lt={class:"value"},Vt={key:3,class:"prop-box"},Ut=(0,o._)("div",{class:"value"},"Unknown IP address",-1),Gt=[Ut],Ht={class:"prop-box"},qt=(0,o._)("div",{class:"category"},"🌐 Explorer",-1),$t={class:"value"},Wt=["href"],Yt={class:"prop-box"},Xt=(0,o._)("div",{class:"category"},"🔒 Bond",-1),Zt={class:"value"},Kt={class:"prop-box"},Qt=(0,o._)("div",{class:"category"},"🏆 Awards",-1),Jt={class:"value"},es={class:"prop-box"},ts=(0,o._)("div",{class:"category"},"😈 Slash points",-1),ss={class:"value"},ns={class:"category"},os={class:"value"},is=["title"],rs={key:1};function as(e,t,s,i,r,a){const c=(0,o.up)("font-awesome-icon"),l=(0,o.Q2)("tippy");return(0,o.wg)(),(0,o.j4)(n.uT,{name:"shrink"},{default:(0,o.w5)((()=>[(0,o._)("div",{class:"window",onKeyup:t[2]||(t[2]=(0,n.D2)((0,n.iM)(((...e)=>a.close&&a.close(...e)),["prevent"]),["esc"])),tabindex:"0",ref:"modal"},[(0,o.wy)((0,o._)("div",{class:"close-button",onClick:t[0]||(t[0]=(...e)=>a.close&&a.close(...e)),content:"Close it"},null,512),[[l]]),ut,(0,o._)("h2",null,[s.node.requestedToLeave?(0,o.wy)(((0,o.wg)(),(0,o.j4)(c,{key:0,class:"icon",icon:"fa-solid fa-arrow-right",content:"Requested to leave!"},null,512)),[[l]]):(0,o.kq)("",!0),s.node.forcedToLeave?(0,o.wy)(((0,o.wg)(),(0,o.j4)(c,{key:1,class:"icon",icon:"fa-solid fa-arrow-down-up-lock",content:"Forced to leave!"},null,512)),[[l]]):(0,o.kq)("",!0),(0,o.Uk)(" "+(0,g.zw)(s.node.address)+" ",1),(0,o.wy)(((0,o.wg)(),(0,o.iD)("button",{class:"copy-button",onClick:t[1]||(t[1]=(...e)=>a.copyNodeAddress&&a.copyNodeAddress(...e)),content:"Copy address"},[(0,o.Wm)(c,{icon:"fa-solid fa-copy"})])),[[l]])]),(0,o._)("div",pt,[(0,o._)("div",mt,[vt,(0,o.Uk)(" "+(0,g.zw)(a.statusEmoji)+" ",1),(0,o._)("span",{class:(0,g.C_)(a.nodeStatusClass)},(0,g.zw)(s.node.status),3)]),(0,o._)("div",ft,[gt,(0,o._)("div",yt,[a.isOldest?(0,o.wy)(((0,o.wg)(),(0,o.iD)("span",_t,St)),[[l]]):(0,o.kq)("",!0),(0,o.Uk)(" "+(0,g.zw)(a.statusSince)+" ",1),(0,o._)("small",null,"(#"+(0,g.zw)(a.ageRank)+")",1)])]),(0,o._)("div",wt,[xt,(0,o._)("div",kt,[a.isUpToDataVersion?(0,o.wy)(((0,o.wg)(),(0,o.iD)("span",Pt,Tt)),[[l]]):(0,o.wy)(((0,o.wg)(),(0,o.iD)("span",Et,Mt)),[[l]]),(0,o.Uk)(" "+(0,g.zw)(s.node.version),1)])]),a.hasIP?((0,o.wg)(),(0,o.iD)("div",Ot,[Nt,(0,o._)("div",Dt,[(0,o._)("a",{href:a.ipAddressInfoLink,target:"_blank"},(0,g.zw)(s.node.IPAddress),9,zt)])])):(0,o.kq)("",!0),a.hasIP?((0,o.wg)(),(0,o.iD)("div",Rt,[It,(0,o._)("div",Bt,(0,g.zw)(s.node.IPInfo?.flag)+" "+(0,g.zw)(s.node.IPInfo?.country)+", "+(0,g.zw)(s.node.IPInfo?.city||"unknown city"),1)])):(0,o.kq)("",!0),a.hasIP?((0,o.wg)(),(0,o.iD)("div",jt,[Ft,(0,o._)("div",Lt,(0,g.zw)(a.providerName),1)])):((0,o.wg)(),(0,o.iD)("div",Vt,Gt)),(0,o._)("div",Ht,[qt,(0,o._)("div",$t,[(0,o._)("a",{href:`https://viewblock.io/thorchain/address/${s.node.address}`,target:"_blank"},"Viewblock – "+(0,g.zw)(s.node.shortAddress),9,Wt)])]),(0,o._)("div",Yt,[Xt,(0,o._)("div",Zt,[(0,o.Uk)((0,g.zw)(a.nodeBond)+" ",1),(0,o._)("small",null,"(#"+(0,g.zw)(a.nodeBondRank)+")",1)])]),(0,o._)("div",Kt,[Qt,(0,o._)("div",Jt,(0,g.zw)(a.award),1)]),(0,o._)("div",es,[ts,(0,o._)("div",ss,[(0,o.Uk)((0,g.zw)(s.node.slashPoints)+" pts. ",1),(0,o._)("small",null,"(#"+(0,g.zw)(a.slashPointsRank)+")",1)])]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(Object.entries(s.node.observeChains),(([e,t])=>((0,o.wg)(),(0,o.iD)("div",{class:"prop-box",key:e},[(0,o._)("div",ns,(0,g.zw)(e),1),(0,o._)("div",os,[a.chainLag(e)?((0,o.wg)(),(0,o.iD)("span",{key:0,title:t,class:"chain-lag"}," 🩸 "+(0,g.zw)(a.chainLag(e))+" blocks behind! ",9,is)):((0,o.wg)(),(0,o.iD)("span",rs," Up to date "))])])))),128))])],544)])),_:1})}var cs=s(1945),ls=s.n(cs);const ds={[K.Active]:{emoji:"✅",class:"status-active"},[K.Standby]:{emoji:"⏳",class:"status-standby"},[K.Disabled]:{emoji:"🔴",class:"status-disabled"},[K.Whitelisted]:{emoji:"📄",class:"status-whitelisted"}};var hs={name:"NodeDetailsWindow",emits:["close"],props:["node","nodeSet"],data(){return{}},computed:{topThorHeight(){return Ke.lastBlock.THOR},hasIP(){return this.node.IPAddress&&""!==this.node.IPAddress},statusEmoji(){return ds[this.node.status]?.emoji},nodeStatusClass(){return ds[this.node.status]?.class},statusSince(){const e=this.nodeSet.estimateTimestampAtBlock(this.topThorHeight,this.node.statusSince);try{return new Date(e).toISOString().slice(0,10)}catch{return"N/A"}},isOldest(){return!0},ageRank(){return this.nodeSet.ranks.age[this.node.address]},award(){return U(Math.round(this.node.currentAward))},nodeBond(){return U(Math.round(this.node.bond))},nodeBondRank(){return this.nodeSet.ranks.bond[this.node.address]},nodeBondPercent(){return this.nodeSet.bondPercentOfTotal(this.node.bond)},ipAddressInfoLink(){return`https://www.infobyip.com/ip-${this.node.IPAddress}.html`},slashPointsRank(){return this.nodeSet.ranks.slash[this.node.address]},chainLag(){return e=>(this.nodeSet.topHeights[e]??0)-(this.node.observeChains[e]??0)},providerName(){const e=this.node?.IPInfo?.providerName??Ne;return De.refineProviderName(e)},isUpToDataVersion(){return this.node.version===this.nodeSet.topVersion}},methods:{copyNodeAddress(){ls()(this.node.address)},close(){this.$emit("close")}},mounted(){this.$refs.modal.focus()}};const us=(0,C.Z)(hs,[["render",as]]);var ps=us,ms=s(8657);class vs{constructor(e,t=new d.Vector3){this.domElement=e,this.center=t,this._createCamera(),this._createCameraControl(),this._animating=!1,this.controlsEnabled=!0}reset(){this.controls.reset()}_createCamera(){this.camera=new d.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.001,2*u.Controls.Camera.Distance.Max),this.camera.position.z=u.Controls.Camera.Distance.Start}_createCameraControl(){const e=this.controls=new ms.Z(this.camera,this.domElement),t=u.Controls.Camera;e.dragToOffset=!0,e.minDistance=t.Distance.Min,e.maxDistance=t.Distance.Max,this.camera.position.z=t.Distance.Start,e.minAzimuthAngle=d.MathUtils.degToRad(-t.AzimuthAngleLimit),e.maxAzimuthAngle=d.MathUtils.degToRad(t.AzimuthAngleLimit),e.minPolarAngle=d.MathUtils.degToRad(90-t.PolarAngleLimit),e.maxPolarAngle=d.MathUtils.degToRad(t.PolarAngleLimit+90),e.update(0)}update(e){!this.controlsEnabled||this._animating||this.cameraInspectsObject||this.controls.update(e)}onResize(){const e=this.domElement,t=e.clientWidth,s=e.clientHeight;this.camera.aspect=t/s,this.camera.updateProjectionMatrix()}_getEndQuaternion(e,t){const s=this.camera.position.clone(),n=this.camera.quaternion.clone();this.camera.position.copy(e),this.camera.lookAt(t);const o=this.camera.quaternion.clone();return this.camera.position.copy(s),this.camera.quaternion.copy(n),o}cameraLookAtNode(e,t){this.cameraInspectsObject||(this.oldCameraPos=this.camera.position.clone(),this.oldCameraQuaternion=this.camera.quaternion.clone(),this.cameraInspectsObject=!0),this._animating=!0;const s=u.Controls.Camera.Animation,n=this;let o,i;if(t)o=e.o.position.clone().add(new d.Vector3(0,0,s.DistanceWhenZoomed)),i=e.o.position.clone();else{const t=e.o.position.clone().normalize().multiplyScalar(s.DistanceWhenZoomed);o=e.o.position.clone().add(t),i=e.o.position.clone()}new(me().Tween)(this.camera.position).to(o,s.Duration).easing(me().Easing.Sinusoidal.InOut).onComplete((()=>{n._animating=!1})).start();const r=this._getEndQuaternion(o,i);new(me().Tween)(this.camera.quaternion).to(r,s.Duration).easing(me().Easing.Sinusoidal.InOut).start()}restoreCamera(){if(this.cameraInspectsObject){this.cameraInspectsObject=!1,this._animating=!0;const e=this,t=u.Controls.Camera.Animation.Duration;new(me().Tween)(this.camera.position).to(this.oldCameraPos,u.Controls.Camera.Animation.Duration).easing(me().Easing.Sinusoidal.InOut).onUpdate((function(){})).onComplete((()=>{e._animating=!1})).start();const s=this._getEndQuaternion(this.oldCameraPos,this.center);new(me().Tween)(this.camera.quaternion).to(s,t).easing(me().Easing.Sinusoidal.InOut).start()}}dispose(){this.controls.dispose()}}const fs={class:"loading-indicator"},gs=(0,o.Uk)("Loading.");function ys(e,t,s,n,i,r){return(0,o.wg)(),(0,o.iD)("div",fs,[gs,(0,o._)("span",null,(0,g.zw)(i.dots),1)])}var _s={name:"LoadingIndicator",data(){return{dots:""}},methods:{tick(){this.dots+=".",this.dots.length>=3&&(this.dots="")}},mounted(){this.timer=setInterval(this.tick,200)},beforeUnmount(){clearInterval(this.timer)}};const bs=(0,C.Z)(_s,[["render",ys],["__scopeId","data-v-3618bf7b"]]);var Ss=bs,ws=s(4870),xs={name:"MainScreen",components:{LoadingIndicator:Ss,NodeDetailsWindow:ps,ControlPanel:ht,FPSCounter:O},props:{},data(){return{isLoading:!0,showFps:u.Debug.ShowFPS,mouseEnterX:0,mouseEnterY:0,tickCounter:0,sceneMode:"normal",fullyLoaded:!1,nodeDetailsVisible:!1,nodeToViewDetails:new We,zoomedToNode:!1,nodeSet:(0,ws.XI)()}},methods:{onKeyDown(e){"KeyR"===e.code?this.cameraController.reset():"KeyF"===e.code?this.showFps=!this.showFps:"KeyH"===e.code&&console.log("help?")},onMouseMove(e){const t=e.clientX,s=e.clientY;if(!this.mouseEnterX)return this.mouseEnterX=t,void(this.mouseEnterY=s);const n=u.Controls.Camera.MouseMoveStrength,o=this.mouseEnterX-t,i=this.mouseEnterY-s;this.mouseEnterX=t,this.mouseEnterY=s,this.cameraController.controls.rotate(o*n,i*n);const r=this._pickObject(e)?.name;this.content.nodeGroup.setElevatedNode(r),this.zoomedToNode||(this.nodeDetailsVisible=!!r,this.nodeDetailsVisible&&(this.nodeToViewDetails=this.content.findNodeByAddress(r)))},onMouseEnter(e){this.mouseEnterX=e.clientX,this.mouseEnterY=e.clientY},onMouseLeave(){},_pickObject(e,t=!1){if(!this.raycaster)return null;const s=this.getCanvasRelativePosition(e);this.raycaster.setFromCamera(s,this.cameraController.camera);const n=this.raycaster.intersectObjects(this.content.nodeGroup.holder.children,!0);t&&console.log("Objects hit by the ray caster: "+n.length);const o=D().filter(D().map(n,"object"),(e=>e.name&&""!==e.name));return o.length?o[0]:null},onClick(e){console.log(e);const t=this._pickObject(e,!0);if(console.log(t),t){const e=t.name;e&&e.startsWith("thor")&&this._onPickNodeObject(e)}else this.nodeDetailsVisible=!1,this.cameraController.restoreCamera()},_onPickNodeObject(e){console.log("Picked node:",e),this.content.pick(e),this.nodeToViewDetails=this.content.findNodeByAddress(e),this.nodeDetailsVisible=!0;const t=this.content.nodeGroup.getByName(e);t&&(this.zoomedToNode=!0,this.cameraController.cameraLookAtNode(t,this.content.nodeGroup.isCurrentModeFlat))},getCanvasRelativePosition(e){const t=this.canvas.getBoundingClientRect(),s={x:e.clientX-t.left,y:e.clientY-t.top};return{x:s.x/this.canvas.clientWidth*2-1,y:-s.y/this.canvas.clientHeight*2+1}},resizeRendererToDisplaySize(){const e=this.renderer,t=e.domElement,s=t.clientWidth,n=t.clientHeight,o=this.composer._width!==s||this.composer._height!==n;return o&&(e.setSize(s,n,!1),this.bloomPass&&this.bloomPass.setSize(s,n),this.composer.setSize(s,n),this.bg&&this.bg.setSize(s,n),this.cameraController.onResize()),o},render(){let e=this.clock.getDelta();"hidden"!==document.visibilityState&&(e>.4&&(e=.01),this.resizeRendererToDisplaySize(this.renderer),me().update(),this.$refs.fps.update(e,this.scene),this.cameraController.update(e),this.content.update(e),this.bg&&this.bg.update(e),this.composer.render(e),requestAnimationFrame(this.render))},makeSkybox(){u.Scene.Background.Enabled&&(this.bg=new it(this.scene),this.bg.install())},makeRenderer(e){let t=this.renderer=new d.WebGLRenderer({canvas:e,antialias:!1,logarithmicDepthBuffer:u.Renderer.LogZBuffer});devicePixelRatio&&(console.log(`Renderer: Setting devicePixelRatio = ${devicePixelRatio}.`),t.setPixelRatio(devicePixelRatio));const s=new v.C(this.scene,this.cameraController.camera);this.composer=new m.xC(t),this.composer.addPass(s);const n=u.Effects.Bloom;n.Enabled&&(this.bloomPass=new f.m(new d.Vector2(window.innerWidth,window.innerHeight),n.Strength,n.Radius,n.Threshold),this.composer.addPass(this.bloomPass))},buildScene(){this.scene.add(this.cameraController.camera),this.makeSkybox(),this.content=new Qe(this.scene,this)},setSceneMode(e){this.sceneMode=e,this.content.nodeGroup&&(this.content.nodeGroup.mode=e)},onFullyLoaded(){console.log("fully loaded! removing loading screen..."),this.isLoading=!1,this.fullyLoaded=!0},onDataArrived(e){this.nodeSet=e},onCloseDetails(){this.zoomedToNode=!1,this.nodeDetailsVisible=!1,this.nodeToViewDetails=new We,this.cameraController.restoreCamera()}},mounted(){this.canvas=this.$refs.canvas,this.clock=new d.Clock,this.scene=new d.Scene,this.cameraController=new vs(this.canvas),this.makeRenderer(this.canvas),this.resizeRendererToDisplaySize(),this.buildScene(),this.raycaster=new d.Raycaster,T.on(A.FullyLoaded,this.onFullyLoaded),T.on(A.DataSourceTick,this.onDataArrived),requestAnimationFrame(this.render)},unmounted(){this.content.dispose(),this.cameraController.dispose(),T.off(A.FullyLoaded),T.off(A.DataSourceTick)}};const ks=(0,C.Z)(xs,[["render",l]]);var Ps=ks,As={name:"App",components:{MainScreen:Ps},data(){return{}},computed:{},created(){document.title="THORViz",this.preloading()},methods:{preloading(){(0,G.C5)({font:u.Font.Main,characters:"abcdefghijklmnopqrstuvwxyz1234567890"},(()=>{console.log("font loading done")}))}}};const Ts=(0,C.Z)(As,[["render",i]]);var Es=Ts,Cs=s(3494),Ms=s(7749),Os=s(8539),Ns=s(814),Ds=(s(6718),s(3016),s(761));(0,Ds.W8)()||alert("WebGL is not supported!"),ms.Z.install({THREE:d}),Cs.vI.add(Os.kZ_,Os.eFW,Os.NC7);const zs=(0,n.ri)(Es);zs.component("font-awesome-icon",Ms.GN),zs.use(Ns.BA,{directive:"tippy",component:"tippy",flipDuration:0,defaultProps:{placement:"top"},popperOptions:{modifiers:{preventOverflow:{enabled:!1}}}}),zs.config.globalProperties.emitter=T,zs.mount("#app")}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(i.exports,i,i.exports,s),i.loaded=!0,i.exports}s.m=e,function(){var e=[];s.O=function(t,n,o,i){if(!n){var r=1/0;for(d=0;d<e.length;d++){n=e[d][0],o=e[d][1],i=e[d][2];for(var a=!0,c=0;c<n.length;c++)(!1&i||r>=i)&&Object.keys(s.O).every((function(e){return s.O[e](n[c])}))?n.splice(c--,1):(a=!1,i<r&&(r=i));if(a){e.splice(d--,1);var l=o();void 0!==l&&(t=l)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,o,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,i,r=n[0],a=n[1],c=n[2],l=0;if(r.some((function(t){return 0!==e[t]}))){for(o in a)s.o(a,o)&&(s.m[o]=a[o]);if(c)var d=c(s)}for(t&&t(n);l<r.length;l++)i=r[l],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(d)},n=self["webpackChunkthorviz"]=self["webpackChunkthorviz"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=s.O(void 0,[998],(function(){return s(6046)}));n=s.O(n)})();
//# sourceMappingURL=app.213a71ef.js.map