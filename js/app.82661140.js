(function(){"use strict";var e={6026:function(e,t,o){var n=o(9242),s=o(3396);function i(e,t,o,n,i,r){const a=(0,s.up)("ThreeTest");return(0,s.wg)(),(0,s.j4)(a)}var r=o(7139);const a={class:"canvas-holder"},c={class:"fps-counter"},d={class:"activity"};function h(e,t,o,i,h,l){return(0,s.wg)(),(0,s.iD)("div",a,[(0,s._)("canvas",{class:"canvas-full",ref:"canvas",tabindex:"1",onKeydown:t[0]||(t[0]=(...e)=>l.onKeyDown&&l.onKeyDown(...e)),onMousemove:t[1]||(t[1]=(...e)=>l.onMouseMove&&l.onMouseMove(...e)),onMouseenter:t[2]||(t[2]=(...e)=>l.onMouseEnter&&l.onMouseEnter(...e)),onMouseleave:t[3]||(t[3]=(...e)=>l.onMouseLeave&&l.onMouseLeave(...e))},null,544),(0,s.wy)((0,s._)("div",c,[(0,s._)("span",null,[(0,s._)("strong",null,(0,r.zw)(Number(h.fps).toFixed(2)),1),(0,s.Uk)(" FPS, "+(0,r.zw)(h.objCount)+" objects",1)]),(0,s.wy)((0,s._)("span",d,"â€¢",512),[[n.F8,h.activityIndicator]])],512),[[n.F8,h.showFps]])])}var l=o(1114),u=o(6265),p=o.n(u);class m{constructor(e,t){this.period=t,this.url=e,this._isRunning=!1,this._timer=0,this.callback=()=>0}run(){this._isRunning?console.warn(`${this.toString()} is already running`):(this._isRunning=!0,console.info(`${this.toString()} started!`),this._tick().then(),this._timer=setInterval((()=>{this._tick().then()}),1e3*this.period))}stop(){this._isRunning&&(clearInterval(this._timer),this._timer=0,this._isRunning=!1,console.info(`${this.toString()} stopped.`))}toString(){return`URLDataSource(${this.url}, ${this.period} sec)`}get isRunning(){return this._isRunning}async _tick(){try{const e=await p().get(this.url,{headers:{"Content-type":"application/json"}});this.callback&&this.callback(e.data)}catch(e){throw console.error(`${this.toString()} tick failed: ${e}`),e}}}const f={DataSource:{NodesURL:"https://thornode.ninerealms.com/thorchain/nodes",PollPeriod:3},Font:{Main:"fonts/NorseBold-2Kge.otf"},Effects:{Bloom:{Enabled:!0,Strength:.5,Threshold:.5,Radius:.5}},Controls:{Distance:1e3,AzimuthAngleLimit:30,PolarAngleLimit:35}},v={LightningBlue:52479,YggdrasilGreen:3407769,MidgardTurqoise:2350280,NightBlack:1055009};var g=o(4806),_=o.n(g);const y={CREATE:"create",DESTROY:"destroy",SLASH:"slash",IP_ADDRESS:"ip_address",STATUS:"status",VERSION:"version",FORCED_LEAVE:"forced_to_leave",REQUESTED_LEAVE:"requested_to_leave",AWARD:"current_award",BOND_CHANGE:"bond",OBSERVE_CHAIN:"observe_chains",ACTIVE_BLOCK_HEIGHT:"active_block_height"};class b{constructor(e,t,o,n,s){this.type=e,this.node=t,this.prevNode=o,this.currValue=n,this.prevValue=s,this.isTramp=!!t&&""===t.node_address}toString(){const e=this.node?this.node.node_address:"?";return`NodeEvent(${this.type}, ${e}, ${this.currValue} => ${this.prevValue})`}}b.EVENT_TYPE=y;const E={Standby:"Standby",Whitelisted:"Whitelisted",Disabled:"Disabled",Active:"Active",Unknown:"Unknown"};class S{constructor(e,t){this.prev=S.prepareNodeList(e),this.curr=S.prepareNodeList(t)}static convertNode(e){return{node_address:e.node_address,status:e.status,active_block_height:BigInt(e.active_block_height),bond:BigInt(e.bond),ip_address:e.ip_address,current_award:BigInt(e.current_award),slash_points:e.slash_points,observe_chains:_().sortBy(e.observe_chains,["chain"]),requested_to_leave:Boolean(e.requested_to_leave),forced_to_leave:Boolean(e.forced_to_leave),version:e.version,bond_providers:{node_address:e.bond_providers.node_address,node_operator_fee:BigInt(e.bond_providers.node_operator_fee),providers:_().sortBy(e.bond_providers.providers||[],["bond","bond_address"])},jail:{node_address:e.jail.node_address,release_height:e.jail.release_height,reason:e.jail.reason||""}}}static prepareNodeList(e){e=_().map(e,S.convertNode);const t=_().filter(e,(e=>e.node_address)),o=e.length-t.length,n=_().keyBy(t,"node_address"),s=_().keys(n);return{trampCount:o,nodeMap:n,nameSet:s}}extractEvents(){const e=[],t=(t,o,n,s)=>{s=s||"node_address",e.push(new b(t,o,n,o?o[s]:"",n?n[s]:""))},o=_().difference(this.curr.nameSet,this.prev.nameSet);for(const a of o){const e=this.curr.nodeMap[a];t(b.EVENT_TYPE.CREATE,e,e)}const n=_().difference(this.prev.nameSet,this.curr.nameSet);for(const a of n){const e=this.prev.nodeMap[a];t(b.EVENT_TYPE.DESTROY,e,e)}const s=b.EVENT_TYPE,i={slash_points:s.SLASH,bond:s.BOND_CHANGE,ip_address:s.IP_ADDRESS,status:s.STATUS,active_block_height:s.ACTIVE_BLOCK_HEIGHT,current_award:s.AWARD,observe_chains:s.OBSERVE_CHAIN},r=_().intersection(this.curr.nameSet,this.prev.nameSet);for(const a of r){const e=this.prev.nodeMap[a],o=this.curr.nodeMap[a],n=_().union(_().keys(e),_().keys(o)),s=_().filter(n,(t=>!_().isEqual(e[t],o[t])));for(const r of s){const n=i[r];n&&t(n,o,e,r)}}return e}}function w(e,t){return void 0===e?t:e}class T{static getRandomInt(e){return Math.floor(Math.random()*e)}static getRandomFloat(e,t){return Math.random()*(t-e)+e}static getRandomSample(e){if(!e)return null;const t=T.getRandomInt(e.length);return e[t]}static removeRandomItem(e){if(Math.random()>.5){const t=T.getRandomInt(e.length);e.splice(t,1)}return e}static randomVector({xMin:e,xMax:t,yMin:o,yMax:n,zMin:s,zMax:i}){return e=w(e,-10),t=w(t,10),o=w(o,-10),n=w(n,10),s=w(s,-10),i=w(i,10),new l.Vector3(T.getRandomFloat(e,t),T.getRandomFloat(o,n),T.getRandomFloat(s,i))}}class R{static clamp(e,t,o){return Math.min(+o,Math.max(+t,+e))}}var M=o(9870);const k=new l.IcosahedronGeometry(1,1),A=8,N=52;class x{constructor(e){this.node=e;let t=1118481;const o=e.status;o===E.Standby?t=1473110:o===E.Active?t=T.getRandomSample([v.LightningBlue,v.YggdrasilGreen]):o===E.Disabled?t=15597568:o===E.Whitelisted?t=4473924:o===E.Unknown&&(t=1118532),this.o=new l.Group,this.material=new l.MeshStandardMaterial({color:t,flatShading:!0}),this.mesh=new l.Mesh(k,this.material),this.normalizedBond=1e-7*Number(e.bond/10000000n);const n=R.clamp(this.normalizedBond*N*.8,A,N);if(this.mesh.scale.setScalar(n),this.o.add(this.mesh),this.mass=1,this.force=new l.Vector3,this.velocity=new l.Vector3,this.friction=0,e.node_address&&e.node_address.length>=4){const t=this.nameTextObj=new M.xv;t.text=e.node_address.slice(-4),t.font=f.Font.Main,t.fontSize=15,t.position.z=40,t.color=16777215,t.sync(),t.anchorX="center",t.anchorY="middle",this.o.add(t)}}dispose(){this.nameTextObj&&this.nameTextObj.dispose()}get radius(){return this.mesh.scale.x}update(e){const t=this.force.multiplyScalar(this.mass);this.velocity.copy(this.velocity.clone().add(t.multiplyScalar(e))),this.velocity.multiplyScalar(R.clamp(1-this.friction,0,1)),this.o.position.copy(this.o.position.clone().add(this.velocity.clone().multiplyScalar(e)))}reactChain(){this.mesh.rotateX(1);const e=this.o.position.clone().normalize(),t=e.cross(new l.Vector3(0,0,1)).multiplyScalar(100);this.velocity.add(t)}reactSlash(){const e=this.material.color.clone();this.velocity.set(T.getRandomFloat(-100,100),T.getRandomFloat(-100,100),0),this.material.color.set(16711680),setTimeout((()=>{this.material.color.set(e)}),100)}}class C{constructor(e){this.parent=e,this._tracker={},this._currentIdent=0,this.bounds={xMin:-60,xMax:60,yMin:-40,yMax:40,zMin:0,zMax:0}}genIdent(e){return e.node_address??String(this._currentIdent++)}findNodeObject(e){return this._tracker[e]}_placeNodeObject(e){const t=T.randomVector(this.bounds);e.o.position.copy(t),this.parent.add(e.o)}createNewNode(e){const t=this.genIdent(e);if(this.findNodeObject(t))return void console.warn("NodeObject already exists. No nothing");console.info(`Create node ${t}.`);const o=new x(e);this.parent.add(o.o),this._placeNodeObject(o),this._tracker[t]=o}destroyNode(e){const t=e.node_address??e,o=this.findNodeObject(t);o?(console.info(`Create node ${t}.`),o.dispose(),this.parent.remove(o.o),delete this._tracker[t]):console.error("node not found!")}_repelForceCalculation(e){const t=100;for(const o of _().values(this._tracker))if(o!==e){const n=e.o.position.distanceTo(o.o.position),s=e.radius+o.radius;if(n<s){const n=e.o.position.clone().sub(o.o.position).normalize().multiplyScalar(t);e.force.add(n),o.force.add(n.negate())}}}update(e){if(isNaN(e))return;const t=350;for(const o of _().values(this._tracker)){const n=o.o.position.length(),s=o.o.position.clone().normalize();n>t?(o.force.copy(s.multiplyScalar(-200)),o.friction=0):(o.force.set(0,0,0),o.friction=.02,o.node.status===E.Active?o.force.add(s.multiplyScalar(-10*o.normalizedBond)):o.force.add(s.multiplyScalar(50))),this._repelForceCalculation(o),o.update(e)}if(Math.random()>.9){const e=T.getRandomSample(_().values(this._tracker));e&&e.reactChain()}}reactEvent(e){const t=this.findNodeObject(e.node.node_address);t&&(e.type===b.EVENT_TYPE.OBSERVE_CHAIN?t.reactChain():e.type===b.EVENT_TYPE.SLASH&&t.reactSlash())}}function D(e){let t=0;return e.traverse((function(){t++})),t}var P=o(227),O=o(8657),z=o(2071),j=o(2338),I=o(9868),L={name:"ThreeTest",components:{},props:{},data(){return{fps:1,showFps:!0,objCount:0,nodes:[],prevNodes:[],activityIndicator:!1,mouseEnterX:0,mouseEnterY:0}},methods:{pokeActivity(){this.activityIndicator=!0,setTimeout((()=>{this.activityIndicator=!1}),100)},onKeyDown(e){"KeyR"===e.code?this.resetCamera():"KeyD"===e.code?this.showFps=!this.showFps:"KeyH"===e.code&&console.log("help?")},onMouseMove(e){const t=e.clientX,o=e.clientY;if(!this.mouseEnterX)return this.mouseEnterX=t,void(this.mouseEnterY=o);const n=5e-4,s=this.mouseEnterX-t,i=this.mouseEnterY-o;this.mouseEnterX=t,this.mouseEnterY=o,this.controls.rotate(s*n,i*n)},onMouseEnter(e){this.mouseEnterX=e.clientX,this.mouseEnterY=e.clientY},onMouseLeave(){},resetCamera(){this.controls.reset()},resizeRendererToDisplaySize(){const e=this.renderer,t=e.domElement,o=t.clientWidth,n=t.clientHeight;this.camera.aspect=o/n,this.camera.updateProjectionMatrix();const s=t.width!==o||t.height!==n;return s&&(e.setSize(o,n,!1),this.bloomPass&&this.bloomPass.setSize(o,n),this.composer.setSize(o,n)),s},render(){const e=this.clock.getDelta();this.controls.update(e),e>0&&(this.fps=1/e,this.nodeGroup.update(e)),P.w.update(e),this.resizeRendererToDisplaySize(this.renderer),this.composer.render(e),requestAnimationFrame(this.render)},createCamera(){this.camera=new l.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.001,2e3),this.camera.position.z=1e3},createCameraControl(){const e=this.controls=new O.Z(this.camera,this.renderer.domElement),t=f.Controls;e.minDistance=t.Distance,e.maxDistance=t.Distance,e.minAzimuthAngle=l.MathUtils.degToRad(-t.AzimuthAngleLimit),e.maxAzimuthAngle=l.MathUtils.degToRad(t.AzimuthAngleLimit),e.minPolarAngle=l.MathUtils.degToRad(90-t.PolarAngleLimit),e.maxPolarAngle=l.MathUtils.degToRad(t.PolarAngleLimit+90),e.update(0)},makeSkybox(){const e="/texture/skybox/star/",t=[e+"right.png",e+"left.png",e+"top.png",e+"bottom.png",e+"back.png",e+"front.png"];this.scene.background=(new l.CubeTextureLoader).load(t)},makeRenderer(e){let t=this.renderer=new l.WebGLRenderer({canvas:e,antialias:!1,logarithmicDepthBuffer:!0});devicePixelRatio&&(console.log(`Renderer: Setting devicePixelRatio = ${devicePixelRatio}.`),t.setPixelRatio(devicePixelRatio));const o=new j.C(this.scene,this.camera);this.composer=new z.xC(t),this.composer.addPass(o);const n=f.Effects.Bloom;n.Enabled&&(this.bloomPass=new I.m(new l.Vector2(window.innerWidth,window.innerHeight),n.Strength,n.Radius,n.Threshold),this.composer.addPass(this.bloomPass))},buildScene(){const e=new l.DirectionalLight("hsl(0, 100%, 100%)");this.scene.add(this.camera),this.scene.add(e);const t=new l.AmbientLight(4210752);this.scene.add(t),this.nodeGroup=new C(this.scene),e.position.set(0,10,1e3),this.makeSkybox()},handleData(e){console.info("Handle Data tick!"),this.prevNodes=this.nodes,this.nodes=e;const t=new S(this.prevNodes,this.nodes),o=t.extractEvents();for(const n of o){const e=n.node;e.node_address&&(n.type===b.EVENT_TYPE.CREATE?this.nodeGroup.createNewNode(e):n.type===b.EVENT_TYPE.DESTROY?this.nodeGroup.destroyNode(e):this.nodeGroup.reactEvent(n))}o.length&&this.pokeActivity(),this.objCount=D(this.scene)}},mounted(){this.canvas=this.$refs.canvas,this.clock=new l.Clock,this.scene=new l.Scene,this.createCamera(this.canvas),this.makeRenderer(this.canvas),this.createCameraControl(),this.resizeRendererToDisplaySize(),this.buildScene(),this.dataSource=new m(f.DataSource.NodesURL,f.DataSource.PollPeriod),this.dataSource.callback=e=>{this.handleData(e)},this.dataSource.run(),requestAnimationFrame(this.render)},unmounted(){this.dataSource.stop(),this.controls.dispose()}},V=o(89);const B=(0,V.Z)(L,[["render",h]]);var F=B,Y={name:"App",components:{ThreeTest:F},data(){return{}},computed:{},created(){document.title="THORViz",this.preloading()},methods:{preloading(){(0,M.C5)({font:f.Font.Main,characters:"abcdefghijklmnopqrstuvwxyz1234567890"},(()=>{console.log("font loading done")}))}}};const H=(0,V.Z)(Y,[["render",i]]);var $=H,G=o(1373);O.Z.install({THREE:l});const U=(0,G.Z)(),K=(0,n.ri)($);K.config.globalProperties.emitter=U,K.mount("#app")}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}o.m=e,function(){var e=[];o.O=function(t,n,s,i){if(!n){var r=1/0;for(h=0;h<e.length;h++){n=e[h][0],s=e[h][1],i=e[h][2];for(var a=!0,c=0;c<n.length;c++)(!1&i||r>=i)&&Object.keys(o.O).every((function(e){return o.O[e](n[c])}))?n.splice(c--,1):(a=!1,i<r&&(r=i));if(a){e.splice(h--,1);var d=s();void 0!==d&&(t=d)}}return t}i=i||0;for(var h=e.length;h>0&&e[h-1][2]>i;h--)e[h]=e[h-1];e[h]=[n,s,i]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,n){var s,i,r=n[0],a=n[1],c=n[2],d=0;if(r.some((function(t){return 0!==e[t]}))){for(s in a)o.o(a,s)&&(o.m[s]=a[s]);if(c)var h=c(o)}for(t&&t(n);d<r.length;d++)i=r[d],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(h)},n=self["webpackChunkthorviz"]=self["webpackChunkthorviz"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=o.O(void 0,[998],(function(){return o(6026)}));n=o.O(n)})();
//# sourceMappingURL=app.82661140.js.map